<html>
    <head>
        <link rel="stylesheet" href="categorical-styles.css">
        <title>Documento de python resaltado</title>
    </head>
    <body>
        <pre><span style='color:crimson'>"""Macintosh binhex compression/decompression.
easy interface:
binhex(inputfilename, outputfilename)
hexbin(inputfilename, outputfilename)
"""</span>

<span style='color:darkblue'>#</span>
<span style='color:darkblue'># Jack Jansen, CWI, August 1995.</span>
<span style='color:darkblue'>#</span>
<span style='color:darkblue'># The module is supposed to be as compatible as possible. Especially the</span>
<span style='color:darkblue'># easy interface should work "as expected" on any platform.</span>
<span style='color:darkblue'># XXXX Note: currently, textfiles appear in mac-form on all platforms.</span>
<span style='color:darkblue'># We seem to lack a simple character-translate in python.</span>
<span style='color:darkblue'># (we should probably use ISO-Latin-1 on all but the mac platform).</span>
<span style='color:darkblue'># XXXX The simple routines are too simple: they expect to hold the complete</span>
<span style='color:darkblue'># files in-core. Should be fixed.</span>
<span style='color:darkblue'># XXXX It would be nice to handle AppleDouble format on unix</span>
<span style='color:darkblue'># (for servers serving macs).</span>
<span style='color:darkblue'># XXXX I don't understand what happens when you get 0x90 times the same byte on</span>
<span style='color:darkblue'># input. The resulting code (xx 90 90) would appear to be interpreted as an</span>
<span style='color:darkblue'># escaped *value* of 0x90. All coders I've seen appear to ignore this nicety...</span>
<span style='color:darkblue'>#</span>
<span style='color:blueviolet'>import</span> <span style='color:darkgreen'>binascii</span>
<span style='color:blueviolet'>import</span> <span style='color:darkgreen'>contextlib</span>
<span style='color:blueviolet'>import</span> <span style='color:darkgreen'>io</span>
<span style='color:blueviolet'>import</span> <span style='color:darkgreen'>os</span>
<span style='color:blueviolet'>import</span> <span style='color:darkgreen'>struct</span>
<span style='color:blueviolet'>import</span> <span style='color:darkgreen'>warnings</span>

<span style='color:darkgreen'>warnings</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>warn</span>(<span style='color:crimson'>'the binhex module is deprecated'</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>DeprecationWarning</span><span style='color:deepskyblue'>,</span>
              <span style='color:darkgreen'>stacklevel</span><span style='color:deepskyblue'>=</span><span style='color:turquoise'>2</span><span style='color:deepskyblue'>)</span>


<span style='color:darkgreen'>__all__</span> <span style='color:deepskyblue'>=</span> <span style='color:deepskyblue'>[</span><span style='color:crimson'>"binhex"</span><span style='color:deepskyblue'>,</span><span style='color:crimson'>"hexbin"</span><span style='color:deepskyblue'>,</span><span style='color:crimson'>"Error"</span><span style='color:deepskyblue'>]</span>

<span style='color:blueviolet'>class</span> <span style='color:darkgreen'>Error</span>(<span style='color:darkgreen'>Exception</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:blueviolet'>pass</span>

<span style='color:darkblue'># States (what have we written)</span>
<span style='color:darkgreen'>_DID_HEADER</span> <span style='color:deepskyblue'>=</span> <span style='color:turquoise'>0</span>
<span style='color:darkgreen'>_DID_DATA</span> <span style='color:deepskyblue'>=</span> <span style='color:turquoise'>1</span>

<span style='color:darkblue'># Various constants</span>
<span style='color:darkgreen'>REASONABLY_LARGE</span> <span style='color:deepskyblue'>=</span> <span style='color:turquoise'>32768</span>  <span style='color:darkblue'># Minimal amount we pass the rle-coder</span>
<span style='color:darkgreen'>LINELEN</span> <span style='color:deepskyblue'>=</span> <span style='color:turquoise'>64</span>
<span style='color:darkgreen'>RUNCHAR</span> <span style='color:deepskyblue'>=</span> <span style='color:chocolate'>b"\x90"</span>

<span style='color:darkblue'>#</span>
<span style='color:darkblue'># This code is no longer byte-order dependent</span>


<span style='color:blueviolet'>class</span> <span style='color:darkgreen'>FInfo</span><span style='color:deepskyblue'>:</span>
    <span style='color:blueviolet'>def</span> <span style='color:darkgreen'>__init__</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>Type</span> <span style='color:deepskyblue'>=</span> <span style='color:crimson'>'????'</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>Creator</span> <span style='color:deepskyblue'>=</span> <span style='color:crimson'>'????'</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>Flags</span> <span style='color:deepskyblue'>=</span> <span style='color:turquoise'>0</span>

<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>getfileinfo</span>(<span style='color:darkgreen'>name</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:darkgreen'>finfo</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>FInfo</span>(<span style='color:deepskyblue'>)</span>
    <span style='color:blueviolet'>with</span> <span style='color:darkgreen'>io</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>open</span>(<span style='color:darkgreen'>name</span><span style='color:deepskyblue'>,</span> <span style='color:crimson'>'rb'</span><span style='color:deepskyblue'>)</span> <span style='color:blueviolet'>as</span> <span style='color:darkgreen'>fp</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkblue'># Quick check for textfile</span>
        <span style='color:darkgreen'>data</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>fp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>read</span>(<span style='color:turquoise'>512</span><span style='color:deepskyblue'>)</span>
        <span style='color:blueviolet'>if</span> <span style='color:turquoise'>0</span> <span style='color:blueviolet'>not</span> <span style='color:blueviolet'>in</span> <span style='color:darkgreen'>data</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>finfo</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>Type</span> <span style='color:deepskyblue'>=</span> <span style='color:crimson'>'TEXT'</span>
        <span style='color:darkgreen'>fp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>seek</span>(<span style='color:turquoise'>0</span><span style='color:deepskyblue'>,</span> <span style='color:turquoise'>2</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>dsize</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>fp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>tell</span>(<span style='color:deepskyblue'>)</span>
    <span style='color:darkgreen'>dir</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>file</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>os</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>path</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>split</span>(<span style='color:darkgreen'>name</span><span style='color:deepskyblue'>)</span>
    <span style='color:darkgreen'>file</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>file</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>replace</span>(<span style='color:crimson'>':'</span><span style='color:deepskyblue'>,</span> <span style='color:crimson'>'-'</span><span style='color:deepskyblue'>,</span> <span style='color:turquoise'>1</span><span style='color:deepskyblue'>)</span>
    <span style='color:blueviolet'>return</span> <span style='color:darkgreen'>file</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>finfo</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>dsize</span><span style='color:deepskyblue'>,</span> <span style='color:turquoise'>0</span>

<span style='color:blueviolet'>class</span> <span style='color:darkgreen'>openrsrc</span><span style='color:deepskyblue'>:</span>
    <span style='color:blueviolet'>def</span> <span style='color:darkgreen'>__init__</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>,</span> <span style='color:fuchsia'>*</span><span style='color:darkgreen'>args</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:blueviolet'>pass</span>

    <span style='color:blueviolet'>def</span> <span style='color:darkgreen'>read</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>,</span> <span style='color:fuchsia'>*</span><span style='color:darkgreen'>args</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:blueviolet'>return</span> <span style='color:chocolate'>b''</span>

    <span style='color:blueviolet'>def</span> <span style='color:darkgreen'>write</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>,</span> <span style='color:fuchsia'>*</span><span style='color:darkgreen'>args</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:blueviolet'>pass</span>

    <span style='color:blueviolet'>def</span> <span style='color:darkgreen'>close</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:blueviolet'>pass</span>


<span style='color:darkblue'># DeprecationWarning is already emitted on "import binhex". There is no need</span>
<span style='color:darkblue'># to repeat the warning at each call to deprecated binascii functions.</span>
<span style='color:deepskyblue'>@</span><span style='color:darkgreen'>contextlib</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>contextmanager</span>
<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>_ignore_deprecation_warning</span>(<span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:blueviolet'>with</span> <span style='color:darkgreen'>warnings</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>catch_warnings</span>(<span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkgreen'>warnings</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>filterwarnings</span>(<span style='color:crimson'>'ignore'</span><span style='color:deepskyblue'>,</span> <span style='color:crimson'>''</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>DeprecationWarning</span><span style='color:deepskyblue'>)</span>
        <span style='color:blueviolet'>yield</span>


<span style='color:blueviolet'>class</span> <span style='color:darkgreen'>_Hqxcoderengine</span><span style='color:deepskyblue'>:</span>
    <span style='color:crimson'>"""Write data to the coder in 3-byte chunks"""</span>

    <span style='color:blueviolet'>def</span> <span style='color:darkgreen'>__init__</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>ofp</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>ofp</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>ofp</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>data</span> <span style='color:deepskyblue'>=</span> <span style='color:chocolate'>b''</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>hqxdata</span> <span style='color:deepskyblue'>=</span> <span style='color:chocolate'>b''</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>linelen</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>LINELEN</span> <span style='color:fuchsia'>-</span> <span style='color:turquoise'>1</span>

    <span style='color:blueviolet'>def</span> <span style='color:darkgreen'>write</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>data</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>data</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>data</span> <span style='color:fuchsia'>+</span> <span style='color:darkgreen'>data</span>
        <span style='color:darkgreen'>datalen</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>len</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>data</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>todo</span> <span style='color:deepskyblue'>=</span> (<span style='color:darkgreen'>datalen</span> <span style='color:fuchsia'>//</span> <span style='color:turquoise'>3</span><span style='color:deepskyblue'>)</span> <span style='color:fuchsia'>*</span> <span style='color:turquoise'>3</span>
        <span style='color:darkgreen'>data</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>data</span><span style='color:deepskyblue'>[</span><span style='color:deepskyblue'>:</span><span style='color:darkgreen'>todo</span><span style='color:deepskyblue'>]</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>data</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>data</span><span style='color:deepskyblue'>[</span><span style='color:darkgreen'>todo</span><span style='color:deepskyblue'>:</span><span style='color:deepskyblue'>]</span>
        <span style='color:blueviolet'>if</span> <span style='color:blueviolet'>not</span> <span style='color:darkgreen'>data</span><span style='color:deepskyblue'>:</span>
            <span style='color:blueviolet'>return</span>
        <span style='color:blueviolet'>with</span> <span style='color:darkgreen'>_ignore_deprecation_warning</span>(<span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>hqxdata</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>hqxdata</span> <span style='color:fuchsia'>+</span> <span style='color:darkgreen'>binascii</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>b2a_hqx</span>(<span style='color:darkgreen'>data</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>_flush</span>(<span style='color:turquoise'>0</span><span style='color:deepskyblue'>)</span>

    <span style='color:blueviolet'>def</span> <span style='color:darkgreen'>_flush</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>force</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkgreen'>first</span> <span style='color:deepskyblue'>=</span> <span style='color:turquoise'>0</span>
        <span style='color:blueviolet'>while</span> <span style='color:darkgreen'>first</span> <span style='color:deepskyblue'>&lt=</span> <span style='color:darkgreen'>len</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>hqxdata</span><span style='color:deepskyblue'>)</span> <span style='color:fuchsia'>-</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>linelen</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>last</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>first</span> <span style='color:fuchsia'>+</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>linelen</span>
            <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>ofp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>write</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>hqxdata</span><span style='color:deepskyblue'>[</span><span style='color:darkgreen'>first</span><span style='color:deepskyblue'>:</span><span style='color:darkgreen'>last</span><span style='color:deepskyblue'>]</span> <span style='color:fuchsia'>+</span> <span style='color:chocolate'>b'\r'</span><span style='color:deepskyblue'>)</span>
            <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>linelen</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>LINELEN</span>
            <span style='color:darkgreen'>first</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>last</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>hqxdata</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>hqxdata</span><span style='color:deepskyblue'>[</span><span style='color:darkgreen'>first</span><span style='color:deepskyblue'>:</span><span style='color:deepskyblue'>]</span>
        <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>force</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>ofp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>write</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>hqxdata</span> <span style='color:fuchsia'>+</span> <span style='color:chocolate'>b':\r'</span><span style='color:deepskyblue'>)</span>

    <span style='color:blueviolet'>def</span> <span style='color:darkgreen'>close</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>data</span><span style='color:deepskyblue'>:</span>
            <span style='color:blueviolet'>with</span> <span style='color:darkgreen'>_ignore_deprecation_warning</span>(<span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
                <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>hqxdata</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>hqxdata</span> <span style='color:fuchsia'>+</span> <span style='color:darkgreen'>binascii</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>b2a_hqx</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>data</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>_flush</span>(<span style='color:turquoise'>1</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>ofp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>close</span>(<span style='color:deepskyblue'>)</span>
        <span style='color:blueviolet'>del</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>ofp</span>

<span style='color:blueviolet'>class</span> <span style='color:darkgreen'>_Rlecoderengine</span><span style='color:deepskyblue'>:</span>
    <span style='color:crimson'>"""Write data to the RLE-coder in suitably large chunks"""</span>

    <span style='color:blueviolet'>def</span> <span style='color:darkgreen'>__init__</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>ofp</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>ofp</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>ofp</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>data</span> <span style='color:deepskyblue'>=</span> <span style='color:chocolate'>b''</span>

    <span style='color:blueviolet'>def</span> <span style='color:darkgreen'>write</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>data</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>data</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>data</span> <span style='color:fuchsia'>+</span> <span style='color:darkgreen'>data</span>
        <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>len</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>data</span><span style='color:deepskyblue'>)</span> <span style='color:fuchsia'>&lt</span> <span style='color:darkgreen'>REASONABLY_LARGE</span><span style='color:deepskyblue'>:</span>
            <span style='color:blueviolet'>return</span>
        <span style='color:blueviolet'>with</span> <span style='color:darkgreen'>_ignore_deprecation_warning</span>(<span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>rledata</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>binascii</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>rlecode_hqx</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>data</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>ofp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>write</span>(<span style='color:darkgreen'>rledata</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>data</span> <span style='color:deepskyblue'>=</span> <span style='color:chocolate'>b''</span>

    <span style='color:blueviolet'>def</span> <span style='color:darkgreen'>close</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>data</span><span style='color:deepskyblue'>:</span>
            <span style='color:blueviolet'>with</span> <span style='color:darkgreen'>_ignore_deprecation_warning</span>(<span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
                <span style='color:darkgreen'>rledata</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>binascii</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>rlecode_hqx</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>data</span><span style='color:deepskyblue'>)</span>
            <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>ofp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>write</span>(<span style='color:darkgreen'>rledata</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>ofp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>close</span>(<span style='color:deepskyblue'>)</span>
        <span style='color:blueviolet'>del</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>ofp</span>

<span style='color:blueviolet'>class</span> <span style='color:darkgreen'>BinHex</span><span style='color:deepskyblue'>:</span>
    <span style='color:blueviolet'>def</span> <span style='color:darkgreen'>__init__</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>name_finfo_dlen_rlen</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>ofp</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkgreen'>name</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>finfo</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>dlen</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>rlen</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>name_finfo_dlen_rlen</span>
        <span style='color:darkgreen'>close_on_error</span> <span style='color:deepskyblue'>=</span> <span style='color:blueviolet'>False</span>
        <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>isinstance</span>(<span style='color:darkgreen'>ofp</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>str</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>ofname</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>ofp</span>
            <span style='color:darkgreen'>ofp</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>io</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>open</span>(<span style='color:darkgreen'>ofname</span><span style='color:deepskyblue'>,</span> <span style='color:crimson'>'wb'</span><span style='color:deepskyblue'>)</span>
            <span style='color:darkgreen'>close_on_error</span> <span style='color:deepskyblue'>=</span> <span style='color:blueviolet'>True</span>
        <span style='color:blueviolet'>try</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>ofp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>write</span>(<span style='color:chocolate'>b'(This file must be converted with BinHex 4.0)\r\r:'</span><span style='color:deepskyblue'>)</span>
            <span style='color:darkgreen'>hqxer</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>_Hqxcoderengine</span>(<span style='color:darkgreen'>ofp</span><span style='color:deepskyblue'>)</span>
            <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>ofp</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>_Rlecoderengine</span>(<span style='color:darkgreen'>hqxer</span><span style='color:deepskyblue'>)</span>
            <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>crc</span> <span style='color:deepskyblue'>=</span> <span style='color:turquoise'>0</span>
            <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>finfo</span> <span style='color:blueviolet'>is</span> <span style='color:blueviolet'>None</span><span style='color:deepskyblue'>:</span>
                <span style='color:darkgreen'>finfo</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>FInfo</span>(<span style='color:deepskyblue'>)</span>
            <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>dlen</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>dlen</span>
            <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>rlen</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>rlen</span>
            <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>_writeinfo</span>(<span style='color:darkgreen'>name</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>finfo</span><span style='color:deepskyblue'>)</span>
            <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>state</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>_DID_HEADER</span>
        <span style='color:blueviolet'>except</span><span style='color:deepskyblue'>:</span>
            <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>close_on_error</span><span style='color:deepskyblue'>:</span>
                <span style='color:darkgreen'>ofp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>close</span>(<span style='color:deepskyblue'>)</span>
            <span style='color:blueviolet'>raise</span>

    <span style='color:blueviolet'>def</span> <span style='color:darkgreen'>_writeinfo</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>name</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>finfo</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkgreen'>nl</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>len</span>(<span style='color:darkgreen'>name</span><span style='color:deepskyblue'>)</span>
        <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>nl</span> <span style='color:fuchsia'>&gt</span> <span style='color:turquoise'>63</span><span style='color:deepskyblue'>:</span>
            <span style='color:blueviolet'>raise</span> <span style='color:darkgreen'>Error</span>(<span style='color:crimson'>'Filename too long'</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>d</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>bytes</span>(<span style='color:deepskyblue'>[</span><span style='color:darkgreen'>nl</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>)</span> <span style='color:fuchsia'>+</span> <span style='color:darkgreen'>name</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>encode</span>(<span style='color:crimson'>"latin-1"</span><span style='color:deepskyblue'>)</span> <span style='color:fuchsia'>+</span> <span style='color:chocolate'>b'\0'</span>
        <span style='color:darkgreen'>tp</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>cr</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>finfo</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>Type</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>finfo</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>Creator</span>
        <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>isinstance</span>(<span style='color:darkgreen'>tp</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>str</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>tp</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>tp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>encode</span>(<span style='color:crimson'>"latin-1"</span><span style='color:deepskyblue'>)</span>
        <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>isinstance</span>(<span style='color:darkgreen'>cr</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>str</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>cr</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>cr</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>encode</span>(<span style='color:crimson'>"latin-1"</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>d2</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>tp</span> <span style='color:fuchsia'>+</span> <span style='color:darkgreen'>cr</span>

        <span style='color:darkblue'># Force all structs to be packed with big-endian</span>
        <span style='color:darkgreen'>d3</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>struct</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>pack</span>(<span style='color:crimson'>'&gth'</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>finfo</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>Flags</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>d4</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>struct</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>pack</span>(<span style='color:crimson'>'&gtii'</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>dlen</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>rlen</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>info</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>d</span> <span style='color:fuchsia'>+</span> <span style='color:darkgreen'>d2</span> <span style='color:fuchsia'>+</span> <span style='color:darkgreen'>d3</span> <span style='color:fuchsia'>+</span> <span style='color:darkgreen'>d4</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>_write</span>(<span style='color:darkgreen'>info</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>_writecrc</span>(<span style='color:deepskyblue'>)</span>

    <span style='color:blueviolet'>def</span> <span style='color:darkgreen'>_write</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>data</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>crc</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>binascii</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>crc_hqx</span>(<span style='color:darkgreen'>data</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>crc</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>ofp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>write</span>(<span style='color:darkgreen'>data</span><span style='color:deepskyblue'>)</span>

    <span style='color:blueviolet'>def</span> <span style='color:darkgreen'>_writecrc</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkblue'># XXXX Should this be here??</span>
        <span style='color:darkblue'># self.crc = binascii.crc_hqx('\0\0', self.crc)</span>
        <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>crc</span> <span style='color:fuchsia'>&lt</span> <span style='color:turquoise'>0</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>fmt</span> <span style='color:deepskyblue'>=</span> <span style='color:crimson'>'&gth'</span>
        <span style='color:blueviolet'>else</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>fmt</span> <span style='color:deepskyblue'>=</span> <span style='color:crimson'>'&gtH'</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>ofp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>write</span>(<span style='color:darkgreen'>struct</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>pack</span>(<span style='color:darkgreen'>fmt</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>crc</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>crc</span> <span style='color:deepskyblue'>=</span> <span style='color:turquoise'>0</span>

    <span style='color:blueviolet'>def</span> <span style='color:darkgreen'>write</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>data</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>state</span> <span style='color:fuchsia'>!=</span> <span style='color:darkgreen'>_DID_HEADER</span><span style='color:deepskyblue'>:</span>
            <span style='color:blueviolet'>raise</span> <span style='color:darkgreen'>Error</span>(<span style='color:crimson'>'Writing data at the wrong time'</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>dlen</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>dlen</span> <span style='color:fuchsia'>-</span> <span style='color:darkgreen'>len</span>(<span style='color:darkgreen'>data</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>_write</span>(<span style='color:darkgreen'>data</span><span style='color:deepskyblue'>)</span>

    <span style='color:blueviolet'>def</span> <span style='color:darkgreen'>close_data</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>dlen</span> <span style='color:fuchsia'>!=</span> <span style='color:turquoise'>0</span><span style='color:deepskyblue'>:</span>
            <span style='color:blueviolet'>raise</span> <span style='color:darkgreen'>Error</span>(<span style='color:crimson'>'Incorrect data size, diff=%r'</span> <span style='color:fuchsia'>%</span> (<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>rlen</span><span style='color:deepskyblue'>,</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>_writecrc</span>(<span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>state</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>_DID_DATA</span>

    <span style='color:blueviolet'>def</span> <span style='color:darkgreen'>write_rsrc</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>data</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>state</span> <span style='color:fuchsia'>&lt</span> <span style='color:darkgreen'>_DID_DATA</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>close_data</span>(<span style='color:deepskyblue'>)</span>
        <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>state</span> <span style='color:fuchsia'>!=</span> <span style='color:darkgreen'>_DID_DATA</span><span style='color:deepskyblue'>:</span>
            <span style='color:blueviolet'>raise</span> <span style='color:darkgreen'>Error</span>(<span style='color:crimson'>'Writing resource data at the wrong time'</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>rlen</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>rlen</span> <span style='color:fuchsia'>-</span> <span style='color:darkgreen'>len</span>(<span style='color:darkgreen'>data</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>_write</span>(<span style='color:darkgreen'>data</span><span style='color:deepskyblue'>)</span>

    <span style='color:blueviolet'>def</span> <span style='color:darkgreen'>close</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>state</span> <span style='color:blueviolet'>is</span> <span style='color:blueviolet'>None</span><span style='color:deepskyblue'>:</span>
            <span style='color:blueviolet'>return</span>
        <span style='color:blueviolet'>try</span><span style='color:deepskyblue'>:</span>
            <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>state</span> <span style='color:fuchsia'>&lt</span> <span style='color:darkgreen'>_DID_DATA</span><span style='color:deepskyblue'>:</span>
                <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>close_data</span>(<span style='color:deepskyblue'>)</span>
            <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>state</span> <span style='color:fuchsia'>!=</span> <span style='color:darkgreen'>_DID_DATA</span><span style='color:deepskyblue'>:</span>
                <span style='color:blueviolet'>raise</span> <span style='color:darkgreen'>Error</span>(<span style='color:crimson'>'Close at the wrong time'</span><span style='color:deepskyblue'>)</span>
            <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>rlen</span> <span style='color:fuchsia'>!=</span> <span style='color:turquoise'>0</span><span style='color:deepskyblue'>:</span>
                <span style='color:blueviolet'>raise</span> <span style='color:darkgreen'>Error</span>(<span style='color:crimson'>"Incorrect resource-datasize, diff=%r"</span> <span style='color:fuchsia'>%</span> (<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>rlen</span><span style='color:deepskyblue'>,</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span>
            <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>_writecrc</span>(<span style='color:deepskyblue'>)</span>
        <span style='color:blueviolet'>finally</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>state</span> <span style='color:deepskyblue'>=</span> <span style='color:blueviolet'>None</span>
            <span style='color:darkgreen'>ofp</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>ofp</span>
            <span style='color:blueviolet'>del</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>ofp</span>
            <span style='color:darkgreen'>ofp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>close</span>(<span style='color:deepskyblue'>)</span>

<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>binhex</span>(<span style='color:darkgreen'>inp</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>out</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:crimson'>"""binhex(infilename, outfilename): create binhex-encoded copy of a file"""</span>
    <span style='color:darkgreen'>finfo</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>getfileinfo</span>(<span style='color:darkgreen'>inp</span><span style='color:deepskyblue'>)</span>
    <span style='color:darkgreen'>ofp</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>BinHex</span>(<span style='color:darkgreen'>finfo</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>out</span><span style='color:deepskyblue'>)</span>

    <span style='color:blueviolet'>with</span> <span style='color:darkgreen'>io</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>open</span>(<span style='color:darkgreen'>inp</span><span style='color:deepskyblue'>,</span> <span style='color:crimson'>'rb'</span><span style='color:deepskyblue'>)</span> <span style='color:blueviolet'>as</span> <span style='color:darkgreen'>ifp</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkblue'># XXXX Do textfile translation on non-mac systems</span>
        <span style='color:blueviolet'>while</span> <span style='color:blueviolet'>True</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>d</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>ifp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>read</span>(<span style='color:turquoise'>128000</span><span style='color:deepskyblue'>)</span>
            <span style='color:blueviolet'>if</span> <span style='color:blueviolet'>not</span> <span style='color:darkgreen'>d</span><span style='color:deepskyblue'>:</span> <span style='color:blueviolet'>break</span>
            <span style='color:darkgreen'>ofp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>write</span>(<span style='color:darkgreen'>d</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>ofp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>close_data</span>(<span style='color:deepskyblue'>)</span>

    <span style='color:darkgreen'>ifp</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>openrsrc</span>(<span style='color:darkgreen'>inp</span><span style='color:deepskyblue'>,</span> <span style='color:crimson'>'rb'</span><span style='color:deepskyblue'>)</span>
    <span style='color:blueviolet'>while</span> <span style='color:blueviolet'>True</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkgreen'>d</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>ifp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>read</span>(<span style='color:turquoise'>128000</span><span style='color:deepskyblue'>)</span>
        <span style='color:blueviolet'>if</span> <span style='color:blueviolet'>not</span> <span style='color:darkgreen'>d</span><span style='color:deepskyblue'>:</span> <span style='color:blueviolet'>break</span>
        <span style='color:darkgreen'>ofp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>write_rsrc</span>(<span style='color:darkgreen'>d</span><span style='color:deepskyblue'>)</span>
    <span style='color:darkgreen'>ofp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>close</span>(<span style='color:deepskyblue'>)</span>
    <span style='color:darkgreen'>ifp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>close</span>(<span style='color:deepskyblue'>)</span>

<span style='color:blueviolet'>class</span> <span style='color:darkgreen'>_Hqxdecoderengine</span><span style='color:deepskyblue'>:</span>
    <span style='color:crimson'>"""Read data via the decoder in 4-byte chunks"""</span>

    <span style='color:blueviolet'>def</span> <span style='color:darkgreen'>__init__</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>ifp</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>ifp</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>ifp</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>eof</span> <span style='color:deepskyblue'>=</span> <span style='color:turquoise'>0</span>

    <span style='color:blueviolet'>def</span> <span style='color:darkgreen'>read</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>totalwtd</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:crimson'>"""Read at least wtd bytes (or until EOF)"""</span>
        <span style='color:darkgreen'>decdata</span> <span style='color:deepskyblue'>=</span> <span style='color:chocolate'>b''</span>
        <span style='color:darkgreen'>wtd</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>totalwtd</span>
        <span style='color:darkblue'>#</span>
        <span style='color:darkblue'># The loop here is convoluted, since we don't really now how</span>
        <span style='color:darkblue'># much to decode: there may be newlines in the incoming data.</span>
        <span style='color:blueviolet'>while</span> <span style='color:darkgreen'>wtd</span> <span style='color:fuchsia'>&gt</span> <span style='color:turquoise'>0</span><span style='color:deepskyblue'>:</span>
            <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>eof</span><span style='color:deepskyblue'>:</span> <span style='color:blueviolet'>return</span> <span style='color:darkgreen'>decdata</span>
            <span style='color:darkgreen'>wtd</span> <span style='color:deepskyblue'>=</span> ((<span style='color:darkgreen'>wtd</span> <span style='color:fuchsia'>+</span> <span style='color:turquoise'>2</span><span style='color:deepskyblue'>)</span> <span style='color:fuchsia'>//</span> <span style='color:turquoise'>3</span><span style='color:deepskyblue'>)</span> <span style='color:fuchsia'>*</span> <span style='color:turquoise'>4</span>
            <span style='color:darkgreen'>data</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>ifp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>read</span>(<span style='color:darkgreen'>wtd</span><span style='color:deepskyblue'>)</span>
            <span style='color:darkblue'>#</span>
            <span style='color:darkblue'># Next problem: there may not be a complete number of</span>
            <span style='color:darkblue'># bytes in what we pass to a2b. Solve by yet another</span>
            <span style='color:darkblue'># loop.</span>
            <span style='color:darkblue'>#</span>
            <span style='color:blueviolet'>while</span> <span style='color:blueviolet'>True</span><span style='color:deepskyblue'>:</span>
                <span style='color:blueviolet'>try</span><span style='color:deepskyblue'>:</span>
                    <span style='color:blueviolet'>with</span> <span style='color:darkgreen'>_ignore_deprecation_warning</span>(<span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
                        <span style='color:darkgreen'>decdatacur</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>eof</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>binascii</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>a2b_hqx</span>(<span style='color:darkgreen'>data</span><span style='color:deepskyblue'>)</span>
                    <span style='color:blueviolet'>break</span>
                <span style='color:blueviolet'>except</span> <span style='color:darkgreen'>binascii</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>Incomplete</span><span style='color:deepskyblue'>:</span>
                    <span style='color:blueviolet'>pass</span>
                <span style='color:darkgreen'>newdata</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>ifp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>read</span>(<span style='color:turquoise'>1</span><span style='color:deepskyblue'>)</span>
                <span style='color:blueviolet'>if</span> <span style='color:blueviolet'>not</span> <span style='color:darkgreen'>newdata</span><span style='color:deepskyblue'>:</span>
                    <span style='color:blueviolet'>raise</span> <span style='color:darkgreen'>Error</span>(<span style='color:crimson'>'Premature EOF on binhex file'</span><span style='color:deepskyblue'>)</span>
                <span style='color:darkgreen'>data</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>data</span> <span style='color:fuchsia'>+</span> <span style='color:darkgreen'>newdata</span>
            <span style='color:darkgreen'>decdata</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>decdata</span> <span style='color:fuchsia'>+</span> <span style='color:darkgreen'>decdatacur</span>
            <span style='color:darkgreen'>wtd</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>totalwtd</span> <span style='color:fuchsia'>-</span> <span style='color:darkgreen'>len</span>(<span style='color:darkgreen'>decdata</span><span style='color:deepskyblue'>)</span>
            <span style='color:blueviolet'>if</span> <span style='color:blueviolet'>not</span> <span style='color:darkgreen'>decdata</span> <span style='color:blueviolet'>and</span> <span style='color:blueviolet'>not</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>eof</span><span style='color:deepskyblue'>:</span>
                <span style='color:blueviolet'>raise</span> <span style='color:darkgreen'>Error</span>(<span style='color:crimson'>'Premature EOF on binhex file'</span><span style='color:deepskyblue'>)</span>
        <span style='color:blueviolet'>return</span> <span style='color:darkgreen'>decdata</span>

    <span style='color:blueviolet'>def</span> <span style='color:darkgreen'>close</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>ifp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>close</span>(<span style='color:deepskyblue'>)</span>

<span style='color:blueviolet'>class</span> <span style='color:darkgreen'>_Rledecoderengine</span><span style='color:deepskyblue'>:</span>
    <span style='color:crimson'>"""Read data via the RLE-coder"""</span>

    <span style='color:blueviolet'>def</span> <span style='color:darkgreen'>__init__</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>ifp</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>ifp</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>ifp</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>pre_buffer</span> <span style='color:deepskyblue'>=</span> <span style='color:chocolate'>b''</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>post_buffer</span> <span style='color:deepskyblue'>=</span> <span style='color:chocolate'>b''</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>eof</span> <span style='color:deepskyblue'>=</span> <span style='color:turquoise'>0</span>

    <span style='color:blueviolet'>def</span> <span style='color:darkgreen'>read</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>wtd</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>wtd</span> <span style='color:fuchsia'>&gt</span> <span style='color:darkgreen'>len</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>post_buffer</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>_fill</span>(<span style='color:darkgreen'>wtd</span> <span style='color:fuchsia'>-</span> <span style='color:darkgreen'>len</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>post_buffer</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>rv</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>post_buffer</span><span style='color:deepskyblue'>[</span><span style='color:deepskyblue'>:</span><span style='color:darkgreen'>wtd</span><span style='color:deepskyblue'>]</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>post_buffer</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>post_buffer</span><span style='color:deepskyblue'>[</span><span style='color:darkgreen'>wtd</span><span style='color:deepskyblue'>:</span><span style='color:deepskyblue'>]</span>
        <span style='color:blueviolet'>return</span> <span style='color:darkgreen'>rv</span>

    <span style='color:blueviolet'>def</span> <span style='color:darkgreen'>_fill</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>wtd</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>pre_buffer</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>pre_buffer</span> <span style='color:fuchsia'>+</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>ifp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>read</span>(<span style='color:darkgreen'>wtd</span> <span style='color:fuchsia'>+</span> <span style='color:turquoise'>4</span><span style='color:deepskyblue'>)</span>
        <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>ifp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>eof</span><span style='color:deepskyblue'>:</span>
            <span style='color:blueviolet'>with</span> <span style='color:darkgreen'>_ignore_deprecation_warning</span>(<span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
                <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>post_buffer</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>post_buffer</span> <span style='color:fuchsia'>+</span> <span style='color:deepskyblue'>\</span>
                    <span style='color:darkgreen'>binascii</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>rledecode_hqx</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>pre_buffer</span><span style='color:deepskyblue'>)</span>
            <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>pre_buffer</span> <span style='color:deepskyblue'>=</span> <span style='color:chocolate'>b''</span>
            <span style='color:blueviolet'>return</span>

        <span style='color:darkblue'>#</span>
        <span style='color:darkblue'># Obfuscated code ahead. We have to take care that we don't</span>
        <span style='color:darkblue'># end up with an orphaned RUNCHAR later on. So, we keep a couple</span>
        <span style='color:darkblue'># of bytes in the buffer, depending on what the end of</span>
        <span style='color:darkblue'># the buffer looks like:</span>
        <span style='color:darkblue'># '\220\0\220' - Keep 3 bytes: repeated \220 (escaped as \220\0)</span>
        <span style='color:darkblue'># '?\220' - Keep 2 bytes: repeated something-else</span>
        <span style='color:darkblue'># '\220\0' - Escaped \220: Keep 2 bytes.</span>
        <span style='color:darkblue'># '?\220?' - Complete repeat sequence: decode all</span>
        <span style='color:darkblue'># otherwise: keep 1 byte.</span>
        <span style='color:darkblue'>#</span>
        <span style='color:darkgreen'>mark</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>len</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>pre_buffer</span><span style='color:deepskyblue'>)</span>
        <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>pre_buffer</span><span style='color:deepskyblue'>[</span><span style='color:fuchsia'>-</span><span style='color:turquoise'>3</span><span style='color:deepskyblue'>:</span><span style='color:deepskyblue'>]</span> <span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>RUNCHAR</span> <span style='color:fuchsia'>+</span> <span style='color:chocolate'>b'\0'</span> <span style='color:fuchsia'>+</span> <span style='color:darkgreen'>RUNCHAR</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>mark</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>mark</span> <span style='color:fuchsia'>-</span> <span style='color:turquoise'>3</span>
        <span style='color:blueviolet'>elif</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>pre_buffer</span><span style='color:deepskyblue'>[</span><span style='color:fuchsia'>-</span><span style='color:turquoise'>1</span><span style='color:deepskyblue'>:</span><span style='color:deepskyblue'>]</span> <span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>RUNCHAR</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>mark</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>mark</span> <span style='color:fuchsia'>-</span> <span style='color:turquoise'>2</span>
        <span style='color:blueviolet'>elif</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>pre_buffer</span><span style='color:deepskyblue'>[</span><span style='color:fuchsia'>-</span><span style='color:turquoise'>2</span><span style='color:deepskyblue'>:</span><span style='color:deepskyblue'>]</span> <span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>RUNCHAR</span> <span style='color:fuchsia'>+</span> <span style='color:chocolate'>b'\0'</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>mark</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>mark</span> <span style='color:fuchsia'>-</span> <span style='color:turquoise'>2</span>
        <span style='color:blueviolet'>elif</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>pre_buffer</span><span style='color:deepskyblue'>[</span><span style='color:fuchsia'>-</span><span style='color:turquoise'>2</span><span style='color:deepskyblue'>:</span><span style='color:fuchsia'>-</span><span style='color:turquoise'>1</span><span style='color:deepskyblue'>]</span> <span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>RUNCHAR</span><span style='color:deepskyblue'>:</span>
            <span style='color:blueviolet'>pass</span> <span style='color:darkblue'># Decode all</span>
        <span style='color:blueviolet'>else</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>mark</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>mark</span> <span style='color:fuchsia'>-</span> <span style='color:turquoise'>1</span>

        <span style='color:blueviolet'>with</span> <span style='color:darkgreen'>_ignore_deprecation_warning</span>(<span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>post_buffer</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>post_buffer</span> <span style='color:fuchsia'>+</span> <span style='color:deepskyblue'>\</span>
                <span style='color:darkgreen'>binascii</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>rledecode_hqx</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>pre_buffer</span><span style='color:deepskyblue'>[</span><span style='color:deepskyblue'>:</span><span style='color:darkgreen'>mark</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>pre_buffer</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>pre_buffer</span><span style='color:deepskyblue'>[</span><span style='color:darkgreen'>mark</span><span style='color:deepskyblue'>:</span><span style='color:deepskyblue'>]</span>

    <span style='color:blueviolet'>def</span> <span style='color:darkgreen'>close</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>ifp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>close</span>(<span style='color:deepskyblue'>)</span>

<span style='color:blueviolet'>class</span> <span style='color:darkgreen'>HexBin</span><span style='color:deepskyblue'>:</span>
    <span style='color:blueviolet'>def</span> <span style='color:darkgreen'>__init__</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>ifp</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>isinstance</span>(<span style='color:darkgreen'>ifp</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>str</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>ifp</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>io</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>open</span>(<span style='color:darkgreen'>ifp</span><span style='color:deepskyblue'>,</span> <span style='color:crimson'>'rb'</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkblue'>#</span>
        <span style='color:darkblue'># Find initial colon.</span>
        <span style='color:darkblue'>#</span>
        <span style='color:blueviolet'>while</span> <span style='color:blueviolet'>True</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>ch</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>ifp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>read</span>(<span style='color:turquoise'>1</span><span style='color:deepskyblue'>)</span>
            <span style='color:blueviolet'>if</span> <span style='color:blueviolet'>not</span> <span style='color:darkgreen'>ch</span><span style='color:deepskyblue'>:</span>
                <span style='color:blueviolet'>raise</span> <span style='color:darkgreen'>Error</span>(<span style='color:crimson'>"No binhex data found"</span><span style='color:deepskyblue'>)</span>
            <span style='color:darkblue'># Cater for \r\n terminated lines (which show up as \n\r, hence</span>
            <span style='color:darkblue'># all lines start with \r)</span>
            <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>ch</span> <span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>=</span> <span style='color:chocolate'>b'\r'</span><span style='color:deepskyblue'>:</span>
                <span style='color:blueviolet'>continue</span>
            <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>ch</span> <span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>=</span> <span style='color:chocolate'>b':'</span><span style='color:deepskyblue'>:</span>
                <span style='color:blueviolet'>break</span>

        <span style='color:darkgreen'>hqxifp</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>_Hqxdecoderengine</span>(<span style='color:darkgreen'>ifp</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>ifp</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>_Rledecoderengine</span>(<span style='color:darkgreen'>hqxifp</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>crc</span> <span style='color:deepskyblue'>=</span> <span style='color:turquoise'>0</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>_readheader</span>(<span style='color:deepskyblue'>)</span>

    <span style='color:blueviolet'>def</span> <span style='color:darkgreen'>_read</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>len</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkgreen'>data</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>ifp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>read</span>(<span style='color:darkgreen'>len</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>crc</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>binascii</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>crc_hqx</span>(<span style='color:darkgreen'>data</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>crc</span><span style='color:deepskyblue'>)</span>
        <span style='color:blueviolet'>return</span> <span style='color:darkgreen'>data</span>

    <span style='color:blueviolet'>def</span> <span style='color:darkgreen'>_checkcrc</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkgreen'>filecrc</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>struct</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>unpack</span>(<span style='color:crimson'>'&gth'</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>ifp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>read</span>(<span style='color:turquoise'>2</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>0</span><span style='color:deepskyblue'>]</span> <span style='color:fuchsia'>&amp</span> <span style='color:turquoise'>0xffff</span>
        <span style='color:darkblue'>#self.crc = binascii.crc_hqx('\0\0', self.crc)</span>
        <span style='color:darkblue'># XXXX Is this needed??</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>crc</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>crc</span> <span style='color:fuchsia'>&amp</span> <span style='color:turquoise'>0xffff</span>
        <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>filecrc</span> <span style='color:fuchsia'>!=</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>crc</span><span style='color:deepskyblue'>:</span>
            <span style='color:blueviolet'>raise</span> <span style='color:darkgreen'>Error</span>(<span style='color:crimson'>'CRC error, computed %x, read %x'</span>
                        <span style='color:fuchsia'>%</span> (<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>crc</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>filecrc</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>crc</span> <span style='color:deepskyblue'>=</span> <span style='color:turquoise'>0</span>

    <span style='color:blueviolet'>def</span> <span style='color:darkgreen'>_readheader</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkgreen'>len</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>_read</span>(<span style='color:turquoise'>1</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>fname</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>_read</span>(<span style='color:darkgreen'>ord</span>(<span style='color:darkgreen'>len</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>rest</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>_read</span>(<span style='color:turquoise'>1</span> <span style='color:fuchsia'>+</span> <span style='color:turquoise'>4</span> <span style='color:fuchsia'>+</span> <span style='color:turquoise'>4</span> <span style='color:fuchsia'>+</span> <span style='color:turquoise'>2</span> <span style='color:fuchsia'>+</span> <span style='color:turquoise'>4</span> <span style='color:fuchsia'>+</span> <span style='color:turquoise'>4</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>_checkcrc</span>(<span style='color:deepskyblue'>)</span>

        <span style='color:darkgreen'>type</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>rest</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>1</span><span style='color:deepskyblue'>:</span><span style='color:turquoise'>5</span><span style='color:deepskyblue'>]</span>
        <span style='color:darkgreen'>creator</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>rest</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>5</span><span style='color:deepskyblue'>:</span><span style='color:turquoise'>9</span><span style='color:deepskyblue'>]</span>
        <span style='color:darkgreen'>flags</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>struct</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>unpack</span>(<span style='color:crimson'>'&gth'</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>rest</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>9</span><span style='color:deepskyblue'>:</span><span style='color:turquoise'>11</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>0</span><span style='color:deepskyblue'>]</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>dlen</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>struct</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>unpack</span>(<span style='color:crimson'>'&gtl'</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>rest</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>11</span><span style='color:deepskyblue'>:</span><span style='color:turquoise'>15</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>0</span><span style='color:deepskyblue'>]</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>rlen</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>struct</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>unpack</span>(<span style='color:crimson'>'&gtl'</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>rest</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>15</span><span style='color:deepskyblue'>:</span><span style='color:turquoise'>19</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>0</span><span style='color:deepskyblue'>]</span>

        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>FName</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>fname</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>FInfo</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>FInfo</span>(<span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>FInfo</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>Creator</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>creator</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>FInfo</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>Type</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>type</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>FInfo</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>Flags</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>flags</span>

        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>state</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>_DID_HEADER</span>

    <span style='color:blueviolet'>def</span> <span style='color:darkgreen'>read</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>,</span> <span style='color:fuchsia'>*</span><span style='color:darkgreen'>n</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>state</span> <span style='color:fuchsia'>!=</span> <span style='color:darkgreen'>_DID_HEADER</span><span style='color:deepskyblue'>:</span>
            <span style='color:blueviolet'>raise</span> <span style='color:darkgreen'>Error</span>(<span style='color:crimson'>'Read data at wrong time'</span><span style='color:deepskyblue'>)</span>
        <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>n</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>n</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>n</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>0</span><span style='color:deepskyblue'>]</span>
            <span style='color:darkgreen'>n</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>min</span>(<span style='color:darkgreen'>n</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>dlen</span><span style='color:deepskyblue'>)</span>
        <span style='color:blueviolet'>else</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>n</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>dlen</span>
        <span style='color:darkgreen'>rv</span> <span style='color:deepskyblue'>=</span> <span style='color:chocolate'>b''</span>
        <span style='color:blueviolet'>while</span> <span style='color:darkgreen'>len</span>(<span style='color:darkgreen'>rv</span><span style='color:deepskyblue'>)</span> <span style='color:fuchsia'>&lt</span> <span style='color:darkgreen'>n</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>rv</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>rv</span> <span style='color:fuchsia'>+</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>_read</span>(<span style='color:darkgreen'>n</span><span style='color:fuchsia'>-</span><span style='color:darkgreen'>len</span>(<span style='color:darkgreen'>rv</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>dlen</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>dlen</span> <span style='color:fuchsia'>-</span> <span style='color:darkgreen'>n</span>
        <span style='color:blueviolet'>return</span> <span style='color:darkgreen'>rv</span>

    <span style='color:blueviolet'>def</span> <span style='color:darkgreen'>close_data</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>state</span> <span style='color:fuchsia'>!=</span> <span style='color:darkgreen'>_DID_HEADER</span><span style='color:deepskyblue'>:</span>
            <span style='color:blueviolet'>raise</span> <span style='color:darkgreen'>Error</span>(<span style='color:crimson'>'close_data at wrong time'</span><span style='color:deepskyblue'>)</span>
        <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>dlen</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>dummy</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>_read</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>dlen</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>_checkcrc</span>(<span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>state</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>_DID_DATA</span>

    <span style='color:blueviolet'>def</span> <span style='color:darkgreen'>read_rsrc</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>,</span> <span style='color:fuchsia'>*</span><span style='color:darkgreen'>n</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>state</span> <span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>_DID_HEADER</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>close_data</span>(<span style='color:deepskyblue'>)</span>
        <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>state</span> <span style='color:fuchsia'>!=</span> <span style='color:darkgreen'>_DID_DATA</span><span style='color:deepskyblue'>:</span>
            <span style='color:blueviolet'>raise</span> <span style='color:darkgreen'>Error</span>(<span style='color:crimson'>'Read resource data at wrong time'</span><span style='color:deepskyblue'>)</span>
        <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>n</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>n</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>n</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>0</span><span style='color:deepskyblue'>]</span>
            <span style='color:darkgreen'>n</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>min</span>(<span style='color:darkgreen'>n</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>rlen</span><span style='color:deepskyblue'>)</span>
        <span style='color:blueviolet'>else</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>n</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>rlen</span>
        <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>rlen</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>rlen</span> <span style='color:fuchsia'>-</span> <span style='color:darkgreen'>n</span>
        <span style='color:blueviolet'>return</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>_read</span>(<span style='color:darkgreen'>n</span><span style='color:deepskyblue'>)</span>

    <span style='color:blueviolet'>def</span> <span style='color:darkgreen'>close</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>state</span> <span style='color:blueviolet'>is</span> <span style='color:blueviolet'>None</span><span style='color:deepskyblue'>:</span>
            <span style='color:blueviolet'>return</span>
        <span style='color:blueviolet'>try</span><span style='color:deepskyblue'>:</span>
            <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>rlen</span><span style='color:deepskyblue'>:</span>
                <span style='color:darkgreen'>dummy</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>read_rsrc</span>(<span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>rlen</span><span style='color:deepskyblue'>)</span>
            <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>_checkcrc</span>(<span style='color:deepskyblue'>)</span>
        <span style='color:blueviolet'>finally</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>state</span> <span style='color:deepskyblue'>=</span> <span style='color:blueviolet'>None</span>
            <span style='color:darkgreen'>self</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>ifp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>close</span>(<span style='color:deepskyblue'>)</span>

<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>hexbin</span>(<span style='color:darkgreen'>inp</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>out</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:crimson'>"""hexbin(infilename, outfilename) - Decode binhexed file"""</span>
    <span style='color:darkgreen'>ifp</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>HexBin</span>(<span style='color:darkgreen'>inp</span><span style='color:deepskyblue'>)</span>
    <span style='color:darkgreen'>finfo</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>ifp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>FInfo</span>
    <span style='color:blueviolet'>if</span> <span style='color:blueviolet'>not</span> <span style='color:darkgreen'>out</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkgreen'>out</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>ifp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>FName</span>

    <span style='color:blueviolet'>with</span> <span style='color:darkgreen'>io</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>open</span>(<span style='color:darkgreen'>out</span><span style='color:deepskyblue'>,</span> <span style='color:crimson'>'wb'</span><span style='color:deepskyblue'>)</span> <span style='color:blueviolet'>as</span> <span style='color:darkgreen'>ofp</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkblue'># XXXX Do translation on non-mac systems</span>
        <span style='color:blueviolet'>while</span> <span style='color:blueviolet'>True</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>d</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>ifp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>read</span>(<span style='color:turquoise'>128000</span><span style='color:deepskyblue'>)</span>
            <span style='color:blueviolet'>if</span> <span style='color:blueviolet'>not</span> <span style='color:darkgreen'>d</span><span style='color:deepskyblue'>:</span> <span style='color:blueviolet'>break</span>
            <span style='color:darkgreen'>ofp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>write</span>(<span style='color:darkgreen'>d</span><span style='color:deepskyblue'>)</span>
    <span style='color:darkgreen'>ifp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>close_data</span>(<span style='color:deepskyblue'>)</span>

    <span style='color:darkgreen'>d</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>ifp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>read_rsrc</span>(<span style='color:turquoise'>128000</span><span style='color:deepskyblue'>)</span>
    <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>d</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkgreen'>ofp</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>openrsrc</span>(<span style='color:darkgreen'>out</span><span style='color:deepskyblue'>,</span> <span style='color:crimson'>'wb'</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>ofp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>write</span>(<span style='color:darkgreen'>d</span><span style='color:deepskyblue'>)</span>
        <span style='color:blueviolet'>while</span> <span style='color:blueviolet'>True</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>d</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>ifp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>read_rsrc</span>(<span style='color:turquoise'>128000</span><span style='color:deepskyblue'>)</span>
            <span style='color:blueviolet'>if</span> <span style='color:blueviolet'>not</span> <span style='color:darkgreen'>d</span><span style='color:deepskyblue'>:</span> <span style='color:blueviolet'>break</span>
            <span style='color:darkgreen'>ofp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>write</span>(<span style='color:darkgreen'>d</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>ofp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>close</span>(<span style='color:deepskyblue'>)</span>

    <span style='color:darkgreen'>ifp</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>close</span>(<span style='color:deepskyblue'>)</span>

        </pre>
    </body>
</html>