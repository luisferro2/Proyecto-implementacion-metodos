<html>
    <head>
        <link rel="stylesheet" href="categorical-styles.css">
        <title>Documento de python resaltado</title>
    </head>
    <body>
        <pre><span style='color:darkblue'># Copyright (c) Facebook, Inc. and its affiliates. All Rights Reserved.</span>

<span style='color:blueviolet'>import</span> <span style='color:darkgreen'>contextlib</span>
<span style='color:blueviolet'>import</span> <span style='color:darkgreen'>os</span>
<span style='color:blueviolet'>import</span> <span style='color:darkgreen'>pathlib</span>
<span style='color:blueviolet'>import</span> <span style='color:darkgreen'>tempfile</span>

<span style='color:blueviolet'>import</span> <span style='color:darkgreen'>av</span>
<span style='color:blueviolet'>import</span> <span style='color:darkgreen'>numpy</span> <span style='color:blueviolet'>as</span> <span style='color:darkgreen'>np</span>
<span style='color:blueviolet'>import</span> <span style='color:darkgreen'>torch</span>
<span style='color:blueviolet'>import</span> <span style='color:darkgreen'>torchvision</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>io</span> <span style='color:blueviolet'>as</span> <span style='color:darkgreen'>io</span>
<span style='color:blueviolet'>import</span> <span style='color:darkgreen'>torchvision</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>transforms</span> <span style='color:blueviolet'>as</span> <span style='color:darkgreen'>transforms</span>
<span style='color:blueviolet'>from</span> <span style='color:darkgreen'>pytorchvideo</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>data</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>dataset_manifest_utils</span> <span style='color:blueviolet'>import</span> (
    <span style='color:darkgreen'>EncodedVideoInfo</span><span style='color:deepskyblue'>,</span>
    <span style='color:darkgreen'>VideoFrameInfo</span><span style='color:deepskyblue'>,</span>
    <span style='color:darkgreen'>VideoInfo</span><span style='color:deepskyblue'>,</span>
<span style='color:deepskyblue'>)</span>
<span style='color:blueviolet'>from</span> <span style='color:darkgreen'>pytorchvideo</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>data</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>utils</span> <span style='color:blueviolet'>import</span> <span style='color:darkgreen'>thwc_to_cthw</span>


<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>create_dummy_video_frames</span>(<span style='color:darkgreen'>num_frames</span><span style='color:deepskyblue'>:</span> <span style='color:darkgreen'>int</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>height</span><span style='color:deepskyblue'>:</span> <span style='color:darkgreen'>int</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>width</span><span style='color:deepskyblue'>:</span> <span style='color:darkgreen'>int</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:darkgreen'>y</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>x</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>torch</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>meshgrid</span>(<span style='color:darkgreen'>torch</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>linspace</span>(<span style='color:fuchsia'>-</span><span style='color:turquoise'>2</span><span style='color:deepskyblue'>,</span> <span style='color:turquoise'>2</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>height</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>torch</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>linspace</span>(<span style='color:fuchsia'>-</span><span style='color:turquoise'>2</span><span style='color:deepskyblue'>,</span> <span style='color:turquoise'>2</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>width</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span>
    <span style='color:darkgreen'>data</span> <span style='color:deepskyblue'>=</span> <span style='color:deepskyblue'>[</span><span style='color:deepskyblue'>]</span>
    <span style='color:blueviolet'>for</span> <span style='color:darkgreen'>i</span> <span style='color:blueviolet'>in</span> <span style='color:darkgreen'>range</span>(<span style='color:darkgreen'>num_frames</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkgreen'>xc</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>float</span>(<span style='color:darkgreen'>i</span><span style='color:deepskyblue'>)</span> <span style='color:fuchsia'>/</span> <span style='color:darkgreen'>num_frames</span>
        <span style='color:darkgreen'>yc</span> <span style='color:deepskyblue'>=</span> <span style='color:turquoise'>1</span> <span style='color:fuchsia'>-</span> <span style='color:darkgreen'>float</span>(<span style='color:darkgreen'>i</span><span style='color:deepskyblue'>)</span> <span style='color:fuchsia'>/</span> (<span style='color:turquoise'>2</span> <span style='color:fuchsia'>*</span> <span style='color:darkgreen'>num_frames</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>d</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>torch</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>exp</span>(<span style='color:fuchsia'>-</span>((<span style='color:darkgreen'>x</span> <span style='color:fuchsia'>-</span> <span style='color:darkgreen'>xc</span><span style='color:deepskyblue'>)</span> <span style='color:fuchsia'>**</span> <span style='color:turquoise'>2</span> <span style='color:fuchsia'>+</span> (<span style='color:darkgreen'>y</span> <span style='color:fuchsia'>-</span> <span style='color:darkgreen'>yc</span><span style='color:deepskyblue'>)</span> <span style='color:fuchsia'>**</span> <span style='color:turquoise'>2</span><span style='color:deepskyblue'>)</span> <span style='color:fuchsia'>/</span> <span style='color:turquoise'>2</span><span style='color:deepskyblue'>)</span> <span style='color:fuchsia'>*</span> <span style='color:turquoise'>255</span>
        <span style='color:darkgreen'>data</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>append</span>(<span style='color:darkgreen'>d</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>unsqueeze</span>(<span style='color:turquoise'>2</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>repeat</span>(<span style='color:turquoise'>1</span><span style='color:deepskyblue'>,</span> <span style='color:turquoise'>1</span><span style='color:deepskyblue'>,</span> <span style='color:turquoise'>3</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>byte</span>(<span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span>
    <span style='color:blueviolet'>return</span> <span style='color:darkgreen'>torch</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>stack</span>(<span style='color:darkgreen'>data</span><span style='color:deepskyblue'>,</span> <span style='color:turquoise'>0</span><span style='color:deepskyblue'>)</span>


<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>create_random_bbox</span>(<span style='color:darkgreen'>num_boxes</span><span style='color:deepskyblue'>:</span> <span style='color:darkgreen'>int</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>height</span><span style='color:deepskyblue'>:</span> <span style='color:darkgreen'>int</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>width</span><span style='color:deepskyblue'>:</span> <span style='color:darkgreen'>int</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:darkgreen'>bboxes</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>torch</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>rand</span>(<span style='color:darkgreen'>num_boxes</span><span style='color:deepskyblue'>,</span> <span style='color:turquoise'>4</span><span style='color:deepskyblue'>)</span>
    <span style='color:darkgreen'>bboxes</span><span style='color:deepskyblue'>[</span><span style='color:deepskyblue'>:</span><span style='color:deepskyblue'>,</span> <span style='color:turquoise'>0</span><span style='color:deepskyblue'>]</span> <span style='color:deepskyblue'>*=</span> <span style='color:darkgreen'>float</span>(<span style='color:darkgreen'>width</span><span style='color:deepskyblue'>)</span> <span style='color:fuchsia'>/</span> <span style='color:saddlebrown'>2.0</span>
    <span style='color:darkgreen'>bboxes</span><span style='color:deepskyblue'>[</span><span style='color:deepskyblue'>:</span><span style='color:deepskyblue'>,</span> <span style='color:turquoise'>2</span><span style='color:deepskyblue'>]</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>bboxes</span><span style='color:deepskyblue'>[</span><span style='color:deepskyblue'>:</span><span style='color:deepskyblue'>,</span> <span style='color:turquoise'>2</span><span style='color:deepskyblue'>]</span> <span style='color:fuchsia'>*</span> <span style='color:darkgreen'>float</span>(<span style='color:darkgreen'>width</span><span style='color:deepskyblue'>)</span> <span style='color:fuchsia'>/</span> <span style='color:saddlebrown'>2.0</span> <span style='color:fuchsia'>+</span> <span style='color:darkgreen'>float</span>(<span style='color:darkgreen'>width</span><span style='color:deepskyblue'>)</span> <span style='color:fuchsia'>/</span> <span style='color:saddlebrown'>2.0</span>
    <span style='color:darkgreen'>bboxes</span><span style='color:deepskyblue'>[</span><span style='color:deepskyblue'>:</span><span style='color:deepskyblue'>,</span> <span style='color:turquoise'>1</span><span style='color:deepskyblue'>]</span> <span style='color:deepskyblue'>*=</span> <span style='color:darkgreen'>float</span>(<span style='color:darkgreen'>height</span><span style='color:deepskyblue'>)</span> <span style='color:fuchsia'>/</span> <span style='color:saddlebrown'>2.0</span>
    <span style='color:darkgreen'>bboxes</span><span style='color:deepskyblue'>[</span><span style='color:deepskyblue'>:</span><span style='color:deepskyblue'>,</span> <span style='color:turquoise'>3</span><span style='color:deepskyblue'>]</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>bboxes</span><span style='color:deepskyblue'>[</span><span style='color:deepskyblue'>:</span><span style='color:deepskyblue'>,</span> <span style='color:turquoise'>3</span><span style='color:deepskyblue'>]</span> <span style='color:fuchsia'>*</span> <span style='color:darkgreen'>float</span>(<span style='color:darkgreen'>height</span><span style='color:deepskyblue'>)</span> <span style='color:fuchsia'>/</span> <span style='color:saddlebrown'>2.0</span> <span style='color:fuchsia'>+</span> <span style='color:darkgreen'>float</span>(<span style='color:darkgreen'>height</span><span style='color:deepskyblue'>)</span> <span style='color:fuchsia'>/</span> <span style='color:saddlebrown'>2.0</span>
    <span style='color:blueviolet'>return</span> <span style='color:darkgreen'>torch</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>floor</span>(<span style='color:darkgreen'>bboxes</span><span style='color:deepskyblue'>)</span>


<span style='color:deepskyblue'>@</span><span style='color:darkgreen'>contextlib</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>contextmanager</span>
<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>temp_encoded_video</span>(<span style='color:darkgreen'>num_frames</span><span style='color:deepskyblue'>:</span> <span style='color:darkgreen'>int</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>fps</span><span style='color:deepskyblue'>:</span> <span style='color:darkgreen'>int</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>height</span><span style='color:deepskyblue'>=</span><span style='color:turquoise'>10</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>width</span><span style='color:deepskyblue'>=</span><span style='color:turquoise'>10</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>prefix</span><span style='color:deepskyblue'>=</span><span style='color:blueviolet'>None</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:crimson'>"""
    Creates a temporary lossless, mp4 video with synthetic content. Uses a context which
    deletes the video after exit.
    """</span>
    <span style='color:darkblue'># Lossless options.</span>
    <span style='color:darkgreen'>video_codec</span> <span style='color:deepskyblue'>=</span> <span style='color:crimson'>"libx264rgb"</span>
    <span style='color:darkgreen'>options</span> <span style='color:deepskyblue'>=</span> <span style='color:deepskyblue'>{</span><span style='color:crimson'>"crf"</span><span style='color:deepskyblue'>:</span> <span style='color:crimson'>"0"</span><span style='color:deepskyblue'>}</span>
    <span style='color:darkgreen'>data</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>create_dummy_video_frames</span>(<span style='color:darkgreen'>num_frames</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>height</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>width</span><span style='color:deepskyblue'>)</span>
    <span style='color:blueviolet'>with</span> <span style='color:darkgreen'>tempfile</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>NamedTemporaryFile</span>(<span style='color:darkgreen'>prefix</span><span style='color:deepskyblue'>=</span><span style='color:darkgreen'>prefix</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>suffix</span><span style='color:deepskyblue'>=</span><span style='color:crimson'>".mp4"</span><span style='color:deepskyblue'>)</span> <span style='color:blueviolet'>as</span> <span style='color:darkgreen'>f</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkgreen'>f</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>close</span>(<span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>io</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>write_video</span>(<span style='color:darkgreen'>f</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>name</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>data</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>fps</span><span style='color:deepskyblue'>=</span><span style='color:darkgreen'>fps</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>video_codec</span><span style='color:deepskyblue'>=</span><span style='color:darkgreen'>video_codec</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>options</span><span style='color:deepskyblue'>=</span><span style='color:darkgreen'>options</span><span style='color:deepskyblue'>)</span>
        <span style='color:blueviolet'>yield</span> <span style='color:darkgreen'>f</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>name</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>thwc_to_cthw</span>(<span style='color:darkgreen'>data</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>to</span>(<span style='color:darkgreen'>torch</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>float32</span><span style='color:deepskyblue'>)</span>
    <span style='color:darkgreen'>os</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>unlink</span>(<span style='color:darkgreen'>f</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>name</span><span style='color:deepskyblue'>)</span>


<span style='color:deepskyblue'>@</span><span style='color:darkgreen'>contextlib</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>contextmanager</span>
<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>temp_encoded_video_with_audio</span>(
    <span style='color:darkgreen'>num_frames</span><span style='color:deepskyblue'>:</span> <span style='color:darkgreen'>int</span><span style='color:deepskyblue'>,</span>
    <span style='color:darkgreen'>fps</span><span style='color:deepskyblue'>:</span> <span style='color:darkgreen'>int</span><span style='color:deepskyblue'>,</span>
    <span style='color:darkgreen'>num_audio_samples</span><span style='color:deepskyblue'>:</span> <span style='color:darkgreen'>int</span><span style='color:deepskyblue'>,</span>
    <span style='color:darkgreen'>audio_rate</span><span style='color:deepskyblue'>:</span> <span style='color:darkgreen'>int</span> <span style='color:deepskyblue'>=</span> <span style='color:turquoise'>48000</span><span style='color:deepskyblue'>,</span>
    <span style='color:darkgreen'>height</span><span style='color:deepskyblue'>=</span><span style='color:turquoise'>10</span><span style='color:deepskyblue'>,</span>
    <span style='color:darkgreen'>width</span><span style='color:deepskyblue'>=</span><span style='color:turquoise'>10</span><span style='color:deepskyblue'>,</span>
    <span style='color:darkgreen'>prefix</span><span style='color:deepskyblue'>=</span><span style='color:blueviolet'>None</span><span style='color:deepskyblue'>,</span>
<span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:darkgreen'>audio_data</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>torch</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>from_numpy</span>(<span style='color:darkgreen'>np</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>random</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>rand</span>(<span style='color:turquoise'>1</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>num_audio_samples</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>astype</span>(<span style='color:crimson'>"<i2"</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span>
    <span style='color:darkgreen'>video_data</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>create_dummy_video_frames</span>(<span style='color:darkgreen'>num_frames</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>height</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>width</span><span style='color:deepskyblue'>)</span>
    <span style='color:blueviolet'>with</span> <span style='color:darkgreen'>tempfile</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>NamedTemporaryFile</span>(<span style='color:darkgreen'>prefix</span><span style='color:deepskyblue'>=</span><span style='color:darkgreen'>prefix</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>suffix</span><span style='color:deepskyblue'>=</span><span style='color:crimson'>".avi"</span><span style='color:deepskyblue'>)</span> <span style='color:blueviolet'>as</span> <span style='color:darkgreen'>f</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkgreen'>f</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>close</span>(<span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>write_audio_video</span>(
            <span style='color:darkgreen'>f</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>name</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>video_data</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>audio_data</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>fps</span><span style='color:deepskyblue'>=</span><span style='color:darkgreen'>fps</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>audio_rate</span><span style='color:deepskyblue'>=</span><span style='color:darkgreen'>audio_rate</span>
        <span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>cthw_video_data</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>thwc_to_cthw</span>(<span style='color:darkgreen'>video_data</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>to</span>(<span style='color:darkgreen'>torch</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>float32</span><span style='color:deepskyblue'>)</span>
        <span style='color:blueviolet'>yield</span> <span style='color:darkgreen'>f</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>name</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>cthw_video_data</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>audio_data</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>0</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>to</span>(<span style='color:darkgreen'>torch</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>float32</span><span style='color:deepskyblue'>)</span>


<span style='color:deepskyblue'>@</span><span style='color:darkgreen'>contextlib</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>contextmanager</span>
<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>temp_frame_video</span>(<span style='color:darkgreen'>frame_image_file_names</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>height</span><span style='color:deepskyblue'>=</span><span style='color:turquoise'>10</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>width</span><span style='color:deepskyblue'>=</span><span style='color:turquoise'>10</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:darkgreen'>data</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>create_dummy_video_frames</span>(<span style='color:darkgreen'>len</span>(<span style='color:darkgreen'>frame_image_file_names</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>height</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>width</span><span style='color:deepskyblue'>)</span>
    <span style='color:darkgreen'>data</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>thwc_to_cthw</span>(<span style='color:darkgreen'>data</span><span style='color:deepskyblue'>)</span>
    <span style='color:blueviolet'>with</span> <span style='color:darkgreen'>tempfile</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>TemporaryDirectory</span>(<span style='color:deepskyblue'>)</span> <span style='color:blueviolet'>as</span> <span style='color:darkgreen'>root_dir</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkgreen'>root_dir</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>pathlib</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>Path</span>(<span style='color:darkgreen'>root_dir</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>root_dir</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>mkdir</span>(<span style='color:darkgreen'>exist_ok</span><span style='color:deepskyblue'>=</span><span style='color:blueviolet'>True</span><span style='color:deepskyblue'>)</span>
        <span style='color:blueviolet'>for</span> <span style='color:darkgreen'>i</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>file_name</span> <span style='color:blueviolet'>in</span> <span style='color:darkgreen'>enumerate</span>(<span style='color:darkgreen'>frame_image_file_names</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>im</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>transforms</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>ToPILImage</span>(<span style='color:deepskyblue'>)</span>(<span style='color:darkgreen'>data</span><span style='color:deepskyblue'>[</span><span style='color:deepskyblue'>:</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>i</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>)</span>
            <span style='color:darkgreen'>im</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>save</span>(<span style='color:darkgreen'>root_dir</span> <span style='color:fuchsia'>/</span> <span style='color:darkgreen'>file_name</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>compress_level</span><span style='color:deepskyblue'>=</span><span style='color:turquoise'>0</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>optimize</span><span style='color:deepskyblue'>=</span><span style='color:blueviolet'>False</span><span style='color:deepskyblue'>)</span>

        <span style='color:blueviolet'>yield</span> <span style='color:darkgreen'>root_dir</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>data</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>to</span>(<span style='color:darkgreen'>torch</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>float32</span><span style='color:deepskyblue'>)</span>


<span style='color:deepskyblue'>@</span><span style='color:darkgreen'>contextlib</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>contextmanager</span>
<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>temp_frame_video_dataset</span>(<span style='color:darkgreen'>num_frames</span><span style='color:deepskyblue'>=</span><span style='color:turquoise'>3</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>fps</span><span style='color:deepskyblue'>=</span><span style='color:turquoise'>30</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:darkgreen'>frame_names</span> <span style='color:deepskyblue'>=</span> <span style='color:deepskyblue'>[</span><span style='color:crimson'>f"{i}.png"</span> <span style='color:blueviolet'>for</span> <span style='color:darkgreen'>i</span> <span style='color:blueviolet'>in</span> <span style='color:darkgreen'>range</span>(<span style='color:darkgreen'>num_frames</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>]</span>
    <span style='color:darkgreen'>video_duration</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>num_frames</span> <span style='color:fuchsia'>/</span> <span style='color:darkgreen'>fps</span>

    <span style='color:darkgreen'>video_frames</span> <span style='color:deepskyblue'>=</span> <span style='color:deepskyblue'>[</span><span style='color:deepskyblue'>]</span>
    <span style='color:darkgreen'>videos</span> <span style='color:deepskyblue'>=</span> <span style='color:deepskyblue'>[</span><span style='color:deepskyblue'>]</span>

    <span style='color:darkblue'># Frame video 1</span>
    <span style='color:blueviolet'>with</span> <span style='color:darkgreen'>temp_frame_video</span>(<span style='color:darkgreen'>frame_names</span><span style='color:deepskyblue'>)</span> <span style='color:blueviolet'>as</span> (<span style='color:darkgreen'>frame_1_video_dir</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>data_1</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkgreen'>video_id</span> <span style='color:deepskyblue'>=</span> <span style='color:crimson'>"1"</span>
        <span style='color:darkgreen'>label</span> <span style='color:deepskyblue'>=</span> <span style='color:crimson'>"0"</span>
        <span style='color:darkgreen'>videos</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>append</span>((<span style='color:darkgreen'>frame_1_video_dir</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>video_id</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>label</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>data_1</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>video_duration</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span>
        <span style='color:blueviolet'>for</span> <span style='color:darkgreen'>i</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>frame_name</span> <span style='color:blueviolet'>in</span> <span style='color:darkgreen'>enumerate</span>(<span style='color:darkgreen'>frame_names</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>original_video_id</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>str</span>(<span style='color:darkgreen'>frame_1_video_dir</span><span style='color:deepskyblue'>)</span>
            <span style='color:darkgreen'>frame_id</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>str</span>(<span style='color:darkgreen'>i</span><span style='color:deepskyblue'>)</span>
            <span style='color:darkgreen'>path</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>pathlib</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>Path</span>(<span style='color:darkgreen'>frame_1_video_dir</span><span style='color:deepskyblue'>)</span> <span style='color:fuchsia'>/</span> <span style='color:darkgreen'>frame_name</span>
            <span style='color:darkgreen'>video_frames</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>append</span>(
                (
                    <span style='color:darkgreen'>original_video_id</span><span style='color:deepskyblue'>,</span>
                    <span style='color:darkgreen'>video_id</span><span style='color:deepskyblue'>,</span>
                    <span style='color:darkgreen'>frame_id</span><span style='color:deepskyblue'>,</span>
                    <span style='color:darkgreen'>path</span><span style='color:deepskyblue'>,</span>
                    <span style='color:darkgreen'>label</span><span style='color:deepskyblue'>,</span>
                    <span style='color:darkgreen'>data_1</span><span style='color:deepskyblue'>,</span>
                <span style='color:deepskyblue'>)</span>
            <span style='color:deepskyblue'>)</span>

        <span style='color:darkblue'># Frame video 2</span>
        <span style='color:blueviolet'>with</span> <span style='color:darkgreen'>temp_frame_video</span>(<span style='color:darkgreen'>frame_names</span><span style='color:deepskyblue'>)</span> <span style='color:blueviolet'>as</span> (<span style='color:darkgreen'>frame_2_video_dir</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>data_2</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>video_id</span> <span style='color:deepskyblue'>=</span> <span style='color:crimson'>"2"</span>
            <span style='color:darkgreen'>label</span> <span style='color:deepskyblue'>=</span> <span style='color:crimson'>"1"</span>
            <span style='color:darkgreen'>videos</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>append</span>((<span style='color:darkgreen'>frame_2_video_dir</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>video_id</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>label</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>data_2</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>video_duration</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span>
            <span style='color:blueviolet'>for</span> <span style='color:darkgreen'>i</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>frame_name</span> <span style='color:blueviolet'>in</span> <span style='color:darkgreen'>enumerate</span>(<span style='color:darkgreen'>frame_names</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
                <span style='color:darkgreen'>original_video_id</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>str</span>(<span style='color:darkgreen'>frame_2_video_dir</span><span style='color:deepskyblue'>)</span>
                <span style='color:darkgreen'>frame_id</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>str</span>(<span style='color:darkgreen'>i</span><span style='color:deepskyblue'>)</span>
                <span style='color:darkgreen'>path</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>pathlib</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>Path</span>(<span style='color:darkgreen'>frame_2_video_dir</span><span style='color:deepskyblue'>)</span> <span style='color:fuchsia'>/</span> <span style='color:darkgreen'>frame_name</span>
                <span style='color:darkgreen'>video_frames</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>append</span>(
                    (
                        <span style='color:darkgreen'>original_video_id</span><span style='color:deepskyblue'>,</span>
                        <span style='color:darkgreen'>video_id</span><span style='color:deepskyblue'>,</span>
                        <span style='color:darkgreen'>frame_id</span><span style='color:deepskyblue'>,</span>
                        <span style='color:darkgreen'>path</span><span style='color:deepskyblue'>,</span>
                        <span style='color:darkgreen'>label</span><span style='color:deepskyblue'>,</span>
                        <span style='color:darkgreen'>data_2</span><span style='color:deepskyblue'>,</span>
                    <span style='color:deepskyblue'>)</span>
                <span style='color:deepskyblue'>)</span>

            <span style='color:blueviolet'>yield</span> <span style='color:darkgreen'>video_frames</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>videos</span>


<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>write_audio_video</span>(<span style='color:darkgreen'>path</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>video</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>audio</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>fps</span><span style='color:deepskyblue'>=</span><span style='color:turquoise'>30</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>audio_rate</span><span style='color:deepskyblue'>=</span><span style='color:turquoise'>48000</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:darkgreen'>video_array</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>torch</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>as_tensor</span>(<span style='color:darkgreen'>video</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>dtype</span><span style='color:deepskyblue'>=</span><span style='color:darkgreen'>torch</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>uint8</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>numpy</span>(<span style='color:deepskyblue'>)</span>
    <span style='color:darkgreen'>audio_array</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>audio</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>numpy</span>(<span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>astype</span>(<span style='color:crimson'>"<i2"</span><span style='color:deepskyblue'>)</span>

    <span style='color:blueviolet'>with</span> <span style='color:darkgreen'>av</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>open</span>(<span style='color:darkgreen'>path</span><span style='color:deepskyblue'>,</span> <span style='color:crimson'>"w"</span><span style='color:deepskyblue'>)</span> <span style='color:blueviolet'>as</span> <span style='color:darkgreen'>container</span><span style='color:deepskyblue'>:</span>

        <span style='color:darkblue'># Add lossless h264 video stream.</span>
        <span style='color:darkgreen'>video_stream</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>container</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>add_stream</span>(<span style='color:crimson'>"libx264rgb"</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>fps</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>video_stream</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>width</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>video_array</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>shape</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>2</span><span style='color:deepskyblue'>]</span>
        <span style='color:darkgreen'>video_stream</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>height</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>video_array</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>shape</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>1</span><span style='color:deepskyblue'>]</span>
        <span style='color:darkgreen'>video_stream</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>pix_fmt</span> <span style='color:deepskyblue'>=</span> <span style='color:crimson'>"rgb24"</span>
        <span style='color:darkgreen'>video_stream</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>options</span> <span style='color:deepskyblue'>=</span> <span style='color:deepskyblue'>{</span><span style='color:crimson'>"crf"</span><span style='color:deepskyblue'>:</span> <span style='color:crimson'>"0"</span><span style='color:deepskyblue'>}</span>  <span style='color:darkblue'># Lossless video option</span>

        <span style='color:darkblue'># Add lossless flac, stereo audio stream.</span>
        <span style='color:darkgreen'>audio_stream</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>container</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>add_stream</span>(<span style='color:crimson'>"flac"</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>rate</span><span style='color:deepskyblue'>=</span><span style='color:darkgreen'>audio_rate</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>layout</span><span style='color:deepskyblue'>=</span><span style='color:crimson'>"stereo"</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>audio_stream</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>codec_context</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>skip_frame</span> <span style='color:deepskyblue'>=</span> <span style='color:crimson'>"NONE"</span>
        <span style='color:darkgreen'>audio_stream</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>time_base</span> <span style='color:deepskyblue'>=</span> <span style='color:crimson'>f"1/{audio_rate}"</span>
        <span style='color:darkgreen'>audio_stream</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>options</span> <span style='color:deepskyblue'>=</span> <span style='color:deepskyblue'>{</span><span style='color:deepskyblue'>}</span>

        <span style='color:darkgreen'>num_audio_samples</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>audio_array</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>shape</span><span style='color:deepskyblue'>[</span><span style='color:fuchsia'>-</span><span style='color:turquoise'>1</span><span style='color:deepskyblue'>]</span>
        <span style='color:darkgreen'>num_video_frames</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>len</span>(<span style='color:darkgreen'>video_array</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>num_audio_samples_per_frame</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>audio_rate</span> <span style='color:fuchsia'>//</span> <span style='color:darkgreen'>fps</span>
        <span style='color:darkgreen'>encoded_audio_index</span> <span style='color:deepskyblue'>=</span> <span style='color:turquoise'>0</span>
        <span style='color:darkgreen'>encoded_video_index</span> <span style='color:deepskyblue'>=</span> <span style='color:turquoise'>0</span>

        <span style='color:darkblue'># Video and audio stream packets are encoded interleaved by their time.</span>
        <span style='color:darkblue'># To do this we start both streams from pts 0 and then encode 1 video frame</span>
        <span style='color:darkblue'># and num_audio_samples_per_frame audio samples continuously until both</span>
        <span style='color:darkblue'># streams have finished encoding.</span>
        <span style='color:blueviolet'>while</span> (
            <span style='color:darkgreen'>encoded_audio_index</span> <span style='color:fuchsia'><</span> <span style='color:darkgreen'>num_audio_samples</span>
            <span style='color:blueviolet'>or</span> <span style='color:darkgreen'>encoded_video_index</span> <span style='color:fuchsia'><</span> <span style='color:darkgreen'>num_video_frames</span>
        <span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>

            <span style='color:darkblue'># Video frame encodings.</span>
            <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>encoded_video_index</span> <span style='color:fuchsia'><</span> <span style='color:darkgreen'>num_video_frames</span><span style='color:deepskyblue'>:</span>
                <span style='color:darkgreen'>frame</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>video_array</span><span style='color:deepskyblue'>[</span><span style='color:darkgreen'>encoded_video_index</span><span style='color:deepskyblue'>]</span>
                <span style='color:darkgreen'>video_frame</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>av</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>VideoFrame</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>from_ndarray</span>(<span style='color:darkgreen'>frame</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>format</span><span style='color:deepskyblue'>=</span><span style='color:crimson'>"rgb24"</span><span style='color:deepskyblue'>)</span>
                <span style='color:darkgreen'>video_frame</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>pict_type</span> <span style='color:deepskyblue'>=</span> <span style='color:crimson'>"NONE"</span>
                <span style='color:darkgreen'>encoded_video_index</span> <span style='color:deepskyblue'>+=</span> <span style='color:turquoise'>1</span>
                <span style='color:blueviolet'>for</span> <span style='color:darkgreen'>packet</span> <span style='color:blueviolet'>in</span> <span style='color:darkgreen'>video_stream</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>encode</span>(<span style='color:darkgreen'>video_frame</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
                    <span style='color:darkgreen'>container</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>mux</span>(<span style='color:darkgreen'>packet</span><span style='color:deepskyblue'>)</span>

            <span style='color:darkblue'># Audio frame encodings.</span>
            <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>encoded_audio_index</span> <span style='color:fuchsia'><</span> <span style='color:darkgreen'>num_audio_samples</span><span style='color:deepskyblue'>:</span>
                <span style='color:darkgreen'>encode_packet_end</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>encoded_audio_index</span> <span style='color:fuchsia'>+</span> <span style='color:darkgreen'>num_audio_samples_per_frame</span>
                <span style='color:darkgreen'>audio_frame</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>av</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>AudioFrame</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>from_ndarray</span>(
                    <span style='color:darkgreen'>audio_array</span><span style='color:deepskyblue'>[</span><span style='color:deepskyblue'>:</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>encoded_audio_index</span><span style='color:deepskyblue'>:</span><span style='color:darkgreen'>encode_packet_end</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>,</span>
                    <span style='color:darkgreen'>format</span><span style='color:deepskyblue'>=</span><span style='color:crimson'>"s16"</span><span style='color:deepskyblue'>,</span>
                    <span style='color:darkgreen'>layout</span><span style='color:deepskyblue'>=</span><span style='color:crimson'>"stereo"</span><span style='color:deepskyblue'>,</span>
                <span style='color:deepskyblue'>)</span>
                <span style='color:darkgreen'>encoded_audio_index</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>encode_packet_end</span>
                <span style='color:darkgreen'>audio_frame</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>rate</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>audio_rate</span>
                <span style='color:darkgreen'>audio_frame</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>time_base</span> <span style='color:deepskyblue'>=</span> <span style='color:crimson'>f"1/{audio_rate}"</span>
                <span style='color:darkgreen'>encoded_packets</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>audio_stream</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>encode</span>(<span style='color:darkgreen'>audio_frame</span><span style='color:deepskyblue'>)</span>
                <span style='color:blueviolet'>for</span> <span style='color:darkgreen'>packet</span> <span style='color:blueviolet'>in</span> <span style='color:darkgreen'>encoded_packets</span><span style='color:deepskyblue'>:</span>
                    <span style='color:darkgreen'>container</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>mux</span>(<span style='color:darkgreen'>packet</span><span style='color:deepskyblue'>)</span>

        <span style='color:darkblue'># Flush streams.</span>
        <span style='color:blueviolet'>for</span> <span style='color:darkgreen'>packet</span> <span style='color:blueviolet'>in</span> <span style='color:darkgreen'>audio_stream</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>encode</span>(<span style='color:blueviolet'>None</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>container</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>mux</span>(<span style='color:darkgreen'>packet</span><span style='color:deepskyblue'>)</span>

        <span style='color:blueviolet'>for</span> <span style='color:darkgreen'>packet</span> <span style='color:blueviolet'>in</span> <span style='color:darkgreen'>video_stream</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>encode</span>(<span style='color:blueviolet'>None</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>container</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>mux</span>(<span style='color:darkgreen'>packet</span><span style='color:deepskyblue'>)</span>


<span style='color:darkgreen'>MOCK_VIDEO_IDS</span> <span style='color:deepskyblue'>=</span> <span style='color:deepskyblue'>[</span><span style='color:crimson'>"vid1"</span><span style='color:deepskyblue'>,</span> <span style='color:crimson'>"vid2"</span><span style='color:deepskyblue'>,</span> <span style='color:crimson'>"vid3"</span><span style='color:deepskyblue'>,</span> <span style='color:crimson'>"vid4"</span><span style='color:deepskyblue'>]</span>
<span style='color:darkgreen'>MOCK_VIDEO_INFOS</span> <span style='color:deepskyblue'>=</span> <span style='color:deepskyblue'>{</span>
    <span style='color:darkgreen'>MOCK_VIDEO_IDS</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>0</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>:</span> <span style='color:darkgreen'>VideoInfo</span>(
        <span style='color:darkgreen'>video_id</span><span style='color:deepskyblue'>=</span><span style='color:darkgreen'>MOCK_VIDEO_IDS</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>0</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>resolution</span><span style='color:deepskyblue'>=</span><span style='color:crimson'>"1080x1920"</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>duration</span><span style='color:deepskyblue'>=</span><span style='color:turquoise'>100</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>fps</span><span style='color:deepskyblue'>=</span><span style='color:turquoise'>30</span>
    <span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>,</span>
    <span style='color:darkgreen'>MOCK_VIDEO_IDS</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>1</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>:</span> <span style='color:darkgreen'>VideoInfo</span>(
        <span style='color:darkgreen'>video_id</span><span style='color:deepskyblue'>=</span><span style='color:darkgreen'>MOCK_VIDEO_IDS</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>1</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>resolution</span><span style='color:deepskyblue'>=</span><span style='color:crimson'>"1080x1920"</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>duration</span><span style='color:deepskyblue'>=</span><span style='color:turquoise'>50</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>fps</span><span style='color:deepskyblue'>=</span><span style='color:turquoise'>60</span>
    <span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>,</span>
    <span style='color:darkgreen'>MOCK_VIDEO_IDS</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>2</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>:</span> <span style='color:darkgreen'>VideoInfo</span>(
        <span style='color:darkgreen'>video_id</span><span style='color:deepskyblue'>=</span><span style='color:darkgreen'>MOCK_VIDEO_IDS</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>2</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>resolution</span><span style='color:deepskyblue'>=</span><span style='color:crimson'>"720x1280"</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>duration</span><span style='color:deepskyblue'>=</span><span style='color:saddlebrown'>1000.09</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>fps</span><span style='color:deepskyblue'>=</span><span style='color:turquoise'>30</span>
    <span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>,</span>
    <span style='color:darkgreen'>MOCK_VIDEO_IDS</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>3</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>:</span> <span style='color:darkgreen'>VideoInfo</span>(
        <span style='color:darkgreen'>video_id</span><span style='color:deepskyblue'>=</span><span style='color:darkgreen'>MOCK_VIDEO_IDS</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>3</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>resolution</span><span style='color:deepskyblue'>=</span><span style='color:crimson'>"720x1280"</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>duration</span><span style='color:deepskyblue'>=</span><span style='color:saddlebrown'>17.001</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>fps</span><span style='color:deepskyblue'>=</span><span style='color:turquoise'>90</span>
    <span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>,</span>
<span style='color:deepskyblue'>}</span>


<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>get_flat_video_frames</span>(<span style='color:darkgreen'>directory</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>file_extension</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:darkgreen'>frame_file_stem</span> <span style='color:deepskyblue'>=</span> <span style='color:crimson'>"frame_"</span>
    <span style='color:blueviolet'>return</span> <span style='color:deepskyblue'>{</span>
        <span style='color:darkgreen'>MOCK_VIDEO_IDS</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>0</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>:</span> <span style='color:darkgreen'>VideoFrameInfo</span>(
            <span style='color:darkgreen'>video_id</span><span style='color:deepskyblue'>=</span><span style='color:darkgreen'>MOCK_VIDEO_IDS</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>0</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>,</span>
            <span style='color:darkgreen'>location</span><span style='color:deepskyblue'>=</span><span style='color:crimson'>f"{directory}/{MOCK_VIDEO_IDS[0]}"</span><span style='color:deepskyblue'>,</span>
            <span style='color:darkgreen'>frame_file_stem</span><span style='color:deepskyblue'>=</span><span style='color:darkgreen'>frame_file_stem</span><span style='color:deepskyblue'>,</span>
            <span style='color:darkgreen'>frame_string_length</span><span style='color:deepskyblue'>=</span><span style='color:turquoise'>16</span><span style='color:deepskyblue'>,</span>
            <span style='color:darkgreen'>min_frame_number</span><span style='color:deepskyblue'>=</span><span style='color:turquoise'>1</span><span style='color:deepskyblue'>,</span>
            <span style='color:darkgreen'>max_frame_number</span><span style='color:deepskyblue'>=</span><span style='color:turquoise'>3000</span><span style='color:deepskyblue'>,</span>
            <span style='color:darkgreen'>file_extension</span><span style='color:deepskyblue'>=</span><span style='color:darkgreen'>file_extension</span><span style='color:deepskyblue'>,</span>
        <span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>,</span>
        <span style='color:darkgreen'>MOCK_VIDEO_IDS</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>1</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>:</span> <span style='color:darkgreen'>VideoFrameInfo</span>(
            <span style='color:darkgreen'>video_id</span><span style='color:deepskyblue'>=</span><span style='color:darkgreen'>MOCK_VIDEO_IDS</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>1</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>,</span>
            <span style='color:darkgreen'>location</span><span style='color:deepskyblue'>=</span><span style='color:crimson'>f"{directory}/{MOCK_VIDEO_IDS[1]}"</span><span style='color:deepskyblue'>,</span>
            <span style='color:darkgreen'>frame_file_stem</span><span style='color:deepskyblue'>=</span><span style='color:darkgreen'>frame_file_stem</span><span style='color:deepskyblue'>,</span>
            <span style='color:darkgreen'>frame_string_length</span><span style='color:deepskyblue'>=</span><span style='color:turquoise'>16</span><span style='color:deepskyblue'>,</span>
            <span style='color:darkgreen'>min_frame_number</span><span style='color:deepskyblue'>=</span><span style='color:turquoise'>2</span><span style='color:deepskyblue'>,</span>
            <span style='color:darkgreen'>max_frame_number</span><span style='color:deepskyblue'>=</span><span style='color:turquoise'>3001</span><span style='color:deepskyblue'>,</span>
            <span style='color:darkgreen'>file_extension</span><span style='color:deepskyblue'>=</span><span style='color:darkgreen'>file_extension</span><span style='color:deepskyblue'>,</span>
        <span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>,</span>
        <span style='color:darkgreen'>MOCK_VIDEO_IDS</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>2</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>:</span> <span style='color:darkgreen'>VideoFrameInfo</span>(
            <span style='color:darkgreen'>video_id</span><span style='color:deepskyblue'>=</span><span style='color:darkgreen'>MOCK_VIDEO_IDS</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>2</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>,</span>
            <span style='color:darkgreen'>location</span><span style='color:deepskyblue'>=</span><span style='color:crimson'>f"{directory}/{MOCK_VIDEO_IDS[2]}"</span><span style='color:deepskyblue'>,</span>
            <span style='color:darkgreen'>frame_file_stem</span><span style='color:deepskyblue'>=</span><span style='color:darkgreen'>frame_file_stem</span><span style='color:deepskyblue'>,</span>
            <span style='color:darkgreen'>frame_string_length</span><span style='color:deepskyblue'>=</span><span style='color:turquoise'>16</span><span style='color:deepskyblue'>,</span>
            <span style='color:darkgreen'>min_frame_number</span><span style='color:deepskyblue'>=</span><span style='color:turquoise'>1</span><span style='color:deepskyblue'>,</span>
            <span style='color:darkgreen'>max_frame_number</span><span style='color:deepskyblue'>=</span><span style='color:turquoise'>30003</span><span style='color:deepskyblue'>,</span>
            <span style='color:darkgreen'>file_extension</span><span style='color:deepskyblue'>=</span><span style='color:darkgreen'>file_extension</span><span style='color:deepskyblue'>,</span>
        <span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>,</span>
        <span style='color:darkgreen'>MOCK_VIDEO_IDS</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>3</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>:</span> <span style='color:darkgreen'>VideoFrameInfo</span>(
            <span style='color:darkgreen'>video_id</span><span style='color:deepskyblue'>=</span><span style='color:darkgreen'>MOCK_VIDEO_IDS</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>3</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>,</span>
            <span style='color:darkgreen'>location</span><span style='color:deepskyblue'>=</span><span style='color:crimson'>f"{directory}/{MOCK_VIDEO_IDS[3]}"</span><span style='color:deepskyblue'>,</span>
            <span style='color:darkgreen'>frame_file_stem</span><span style='color:deepskyblue'>=</span><span style='color:darkgreen'>frame_file_stem</span><span style='color:deepskyblue'>,</span>
            <span style='color:darkgreen'>frame_string_length</span><span style='color:deepskyblue'>=</span><span style='color:turquoise'>16</span><span style='color:deepskyblue'>,</span>
            <span style='color:darkgreen'>min_frame_number</span><span style='color:deepskyblue'>=</span><span style='color:turquoise'>1</span><span style='color:deepskyblue'>,</span>
            <span style='color:darkgreen'>max_frame_number</span><span style='color:deepskyblue'>=</span><span style='color:turquoise'>1530</span><span style='color:deepskyblue'>,</span>
            <span style='color:darkgreen'>file_extension</span><span style='color:deepskyblue'>=</span><span style='color:darkgreen'>file_extension</span><span style='color:deepskyblue'>,</span>
        <span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>,</span>
    <span style='color:deepskyblue'>}</span>


<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>get_encoded_video_infos</span>(<span style='color:darkgreen'>directory</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>exit_stack</span><span style='color:deepskyblue'>=</span><span style='color:blueviolet'>None</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:darkgreen'>encoded_video_infos</span> <span style='color:deepskyblue'>=</span> <span style='color:deepskyblue'>{</span><span style='color:deepskyblue'>}</span>
    <span style='color:blueviolet'>for</span> <span style='color:darkgreen'>video_id</span> <span style='color:blueviolet'>in</span> <span style='color:darkgreen'>MOCK_VIDEO_IDS</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkgreen'>file_path</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>_</span> <span style='color:deepskyblue'>=</span> (
            <span style='color:darkgreen'>exit_stack</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>enter_context</span>(<span style='color:darkgreen'>temp_encoded_video</span>(<span style='color:turquoise'>10</span><span style='color:deepskyblue'>,</span> <span style='color:turquoise'>10</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span>
            <span style='color:blueviolet'>if</span> <span style='color:darkgreen'>exit_stack</span>
            <span style='color:blueviolet'>else</span> (<span style='color:crimson'>f"{directory}/{video_id}.mp4"</span><span style='color:deepskyblue'>,</span> <span style='color:blueviolet'>None</span><span style='color:deepskyblue'>)</span>
        <span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>encoded_video_infos</span><span style='color:deepskyblue'>[</span><span style='color:darkgreen'>video_id</span><span style='color:deepskyblue'>]</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>EncodedVideoInfo</span>(<span style='color:darkgreen'>video_id</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>file_path</span><span style='color:deepskyblue'>)</span>
    <span style='color:blueviolet'>return</span> <span style='color:darkgreen'>encoded_video_infos</span>
        </pre>
    </body>
</html>