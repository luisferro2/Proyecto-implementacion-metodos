<html>
    <head>
        <link rel="stylesheet" href="categorical-styles.css">
        <title>Documento de python resaltado</title>
    </head>
    <body>
        <pre><span style='color:blueviolet'>import</span> <span style='color:darkgreen'>os</span>
<span style='color:blueviolet'>import</span> <span style='color:darkgreen'>random</span>
<span style='color:blueviolet'>import</span> <span style='color:darkgreen'>pytest</span>
<span style='color:blueviolet'>from</span> <span style='color:darkgreen'>datetime</span> <span style='color:blueviolet'>import</span> <span style='color:darkgreen'>datetime</span>
<span style='color:blueviolet'>from</span> <span style='color:darkgreen'>unittest</span> <span style='color:blueviolet'>import</span> <span style='color:darkgreen'>mock</span>
<span style='color:blueviolet'>from</span> <span style='color:darkgreen'>unittest</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>mock</span> <span style='color:blueviolet'>import</span> <span style='color:darkgreen'>MagicMock</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>Mock</span>
<span style='color:blueviolet'>from</span> <span style='color:darkgreen'>urllib</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>error</span> <span style='color:blueviolet'>import</span> <span style='color:darkgreen'>HTTPError</span>

<span style='color:blueviolet'>from</span> <span style='color:darkgreen'>pytube</span> <span style='color:blueviolet'>import</span> <span style='color:darkgreen'>request</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>Stream</span>


<span style='color:deepskyblue'>@</span><span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>patch</span>(<span style='color:crimson'>"pytube.streams.request"</span><span style='color:deepskyblue'>)</span>
<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>test_stream_to_buffer</span>(<span style='color:darkgreen'>mock_request</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:darkblue'># Given</span>
    <span style='color:darkgreen'>stream_bytes</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>iter</span>(
        <span style='color:deepskyblue'>[</span>
            <span style='color:darkgreen'>bytes</span>(<span style='color:darkgreen'>os</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>urandom</span>(<span style='color:turquoise'>8</span> <span style='color:fuchsia'>*</span> <span style='color:turquoise'>1024</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>,</span>
            <span style='color:darkgreen'>bytes</span>(<span style='color:darkgreen'>os</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>urandom</span>(<span style='color:turquoise'>8</span> <span style='color:fuchsia'>*</span> <span style='color:turquoise'>1024</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>,</span>
            <span style='color:darkgreen'>bytes</span>(<span style='color:darkgreen'>os</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>urandom</span>(<span style='color:turquoise'>8</span> <span style='color:fuchsia'>*</span> <span style='color:turquoise'>1024</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>,</span>
        <span style='color:deepskyblue'>]</span>
    <span style='color:deepskyblue'>)</span>
    <span style='color:darkgreen'>mock_request</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>stream</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>return_value</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>stream_bytes</span>
    <span style='color:darkgreen'>buffer</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>MagicMock</span>(<span style='color:deepskyblue'>)</span>
    <span style='color:darkblue'># When</span>
    <span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>streams</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>0</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>stream_to_buffer</span>(<span style='color:darkgreen'>buffer</span><span style='color:deepskyblue'>)</span>
    <span style='color:darkblue'># Then</span>
    <span style='color:blueviolet'>assert</span> <span style='color:darkgreen'>buffer</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>write</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>call_count</span> <span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>=</span> <span style='color:turquoise'>3</span>


<span style='color:deepskyblue'>@</span><span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>patch</span>(
    <span style='color:crimson'>"pytube.streams.request.head"</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>MagicMock</span>(<span style='color:darkgreen'>return_value</span><span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>{</span><span style='color:crimson'>"content-length"</span><span style='color:deepskyblue'>:</span> <span style='color:crimson'>"6796391"</span><span style='color:deepskyblue'>}</span><span style='color:deepskyblue'>)</span>
<span style='color:deepskyblue'>)</span>
<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>test_filesize</span>(<span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:blueviolet'>assert</span> <span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>streams</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>0</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>filesize</span> <span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>=</span> <span style='color:turquoise'>6796391</span>


<span style='color:deepskyblue'>@</span><span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>patch</span>(
    <span style='color:crimson'>"pytube.streams.request.head"</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>MagicMock</span>(<span style='color:darkgreen'>return_value</span><span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>{</span><span style='color:crimson'>"content-length"</span><span style='color:deepskyblue'>:</span> <span style='color:crimson'>"6796391"</span><span style='color:deepskyblue'>}</span><span style='color:deepskyblue'>)</span>
<span style='color:deepskyblue'>)</span>
<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>test_filesize_approx</span>(<span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:darkgreen'>stream</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>streams</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>0</span><span style='color:deepskyblue'>]</span>

    <span style='color:blueviolet'>assert</span> <span style='color:darkgreen'>stream</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>filesize_approx</span> <span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>=</span> <span style='color:turquoise'>28309811</span>
    <span style='color:darkgreen'>stream</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>bitrate</span> <span style='color:deepskyblue'>=</span> <span style='color:blueviolet'>None</span>
    <span style='color:blueviolet'>assert</span> <span style='color:darkgreen'>stream</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>filesize_approx</span> <span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>=</span> <span style='color:turquoise'>6796391</span>


<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>test_default_filename</span>(<span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:darkgreen'>expected</span> <span style='color:deepskyblue'>=</span> <span style='color:crimson'>"YouTube Rewind 2019 For the Record  YouTubeRewind.mp4"</span>
    <span style='color:darkgreen'>stream</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>streams</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>0</span><span style='color:deepskyblue'>]</span>
    <span style='color:blueviolet'>assert</span> <span style='color:darkgreen'>stream</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>default_filename</span> <span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>expected</span>


<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>test_title</span>(<span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:darkgreen'>expected</span> <span style='color:deepskyblue'>=</span> <span style='color:crimson'>"YouTube Rewind 2019: For the Record | #YouTubeRewind"</span>
    <span style='color:blueviolet'>assert</span> <span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>title</span> <span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>expected</span>


<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>test_expiration</span>(<span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:blueviolet'>assert</span> <span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>streams</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>0</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>expiration</span> <span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>datetime</span>(<span style='color:turquoise'>2020</span><span style='color:deepskyblue'>,</span> <span style='color:turquoise'>10</span><span style='color:deepskyblue'>,</span> <span style='color:turquoise'>30</span><span style='color:deepskyblue'>,</span> <span style='color:turquoise'>5</span><span style='color:deepskyblue'>,</span> <span style='color:turquoise'>39</span><span style='color:deepskyblue'>,</span> <span style='color:turquoise'>41</span><span style='color:deepskyblue'>)</span>


<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>test_caption_tracks</span>(<span style='color:darkgreen'>presigned_video</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:blueviolet'>assert</span> <span style='color:darkgreen'>len</span>(<span style='color:darkgreen'>presigned_video</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>caption_tracks</span><span style='color:deepskyblue'>)</span> <span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>=</span> <span style='color:turquoise'>13</span>


<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>test_captions</span>(<span style='color:darkgreen'>presigned_video</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:blueviolet'>assert</span> <span style='color:darkgreen'>len</span>(<span style='color:darkgreen'>presigned_video</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>captions</span><span style='color:deepskyblue'>)</span> <span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>=</span> <span style='color:turquoise'>13</span>


<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>test_description</span>(<span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:darkgreen'>expected</span> <span style='color:deepskyblue'>=</span> (
        <span style='color:crimson'>"In 2018, we made something you didn’t like. "</span>
        <span style='color:crimson'>"For Rewind 2019, let’s see what you DID like.\n\n"</span>
        <span style='color:crimson'>"Celebrating the creators, music and moments "</span>
        <span style='color:crimson'>"that mattered most to you in 2019. \n\n"</span>
        <span style='color:crimson'>"To learn how the top lists in Rewind were generated: "</span>
        <span style='color:crimson'>"https://rewind.youtube/about\n\n"</span>
        <span style='color:crimson'>"Top lists featured the following channels:\n\n"</span>
        <span style='color:crimson'>"@1MILLION Dance Studio \n@A4 \n@Anaysa \n"</span>
        <span style='color:crimson'>"@Andymation \n@Ariana Grande \n@Awez Darbar \n"</span>
        <span style='color:crimson'>"@AzzyLand \n@Billie Eilish \n@Black Gryph0n \n"</span>
        <span style='color:crimson'>"@BLACKPINK \n@ChapkisDanceUSA \n@Daddy Yankee \n"</span>
        <span style='color:crimson'>"@David Dobrik \n@Dude Perfect \n@Felipe Neto \n"</span>
        <span style='color:crimson'>"@Fischer's-フィッシャーズ- \n@Galen Hooks \n@ibighit \n"</span>
        <span style='color:crimson'>"@James Charles \n@jeffreestar \n@Jelly \n@Kylie Jenner \n"</span>
        <span style='color:crimson'>"@LazarBeam \n@Lil Dicky \n@Lil Nas X \n@LOUD \n@LOUD Babi \n"</span>
        <span style='color:crimson'>"@LOUD Coringa \n@Magnet World \n@MrBeast \n"</span>
        <span style='color:crimson'>"@Nilson Izaias Papinho Oficial \n@Noah Schnapp\n"</span>
        <span style='color:crimson'>"@백종원의 요리비책 Paik's Cuisine \n@Pencilmation \n@PewDiePie \n"</span>
        <span style='color:crimson'>"@SethEverman \n@shane \n@Shawn Mendes \n@Team Naach \n"</span>
        <span style='color:crimson'>"@whinderssonnunes \n@워크맨-Workman \n@하루한끼 one meal a day \n\n"</span>
        <span style='color:crimson'>"To see the full list of featured channels in Rewind 2019, "</span>
        <span style='color:crimson'>"visit: https://rewind.youtube/about"</span>
    <span style='color:deepskyblue'>)</span>
    <span style='color:blueviolet'>assert</span> <span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>description</span> <span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>expected</span>


<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>test_rating</span>(<span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:blueviolet'>assert</span> <span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>rating</span> <span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>=</span> <span style='color:saddlebrown'>2.0860765</span>


<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>test_length</span>(<span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:blueviolet'>assert</span> <span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>length</span> <span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>=</span> <span style='color:turquoise'>337</span>


<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>test_views</span>(<span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:blueviolet'>assert</span> <span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>views</span> <span style='color:deepskyblue'>>=</span> <span style='color:turquoise'>108531745</span>


<span style='color:deepskyblue'>@</span><span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>patch</span>(
    <span style='color:crimson'>"pytube.streams.request.head"</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>MagicMock</span>(<span style='color:darkgreen'>return_value</span><span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>{</span><span style='color:crimson'>"content-length"</span><span style='color:deepskyblue'>:</span> <span style='color:crimson'>"6796391"</span><span style='color:deepskyblue'>}</span><span style='color:deepskyblue'>)</span>
<span style='color:deepskyblue'>)</span>
<span style='color:deepskyblue'>@</span><span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>patch</span>(
    <span style='color:crimson'>"pytube.streams.request.stream"</span><span style='color:deepskyblue'>,</span>
    <span style='color:darkgreen'>MagicMock</span>(<span style='color:darkgreen'>return_value</span><span style='color:deepskyblue'>=</span><span style='color:darkgreen'>iter</span>(<span style='color:deepskyblue'>[</span><span style='color:darkgreen'>str</span>(<span style='color:darkgreen'>random</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>getrandbits</span>(<span style='color:turquoise'>8</span> <span style='color:fuchsia'>*</span> <span style='color:turquoise'>1024</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>,</span>
<span style='color:deepskyblue'>)</span>
<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>test_download</span>(<span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:blueviolet'>with</span> <span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>patch</span>(<span style='color:crimson'>"pytube.streams.open"</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>mock_open</span>(<span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>create</span><span style='color:deepskyblue'>=</span><span style='color:blueviolet'>True</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkgreen'>stream</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>streams</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>0</span><span style='color:deepskyblue'>]</span>
        <span style='color:darkgreen'>stream</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>download</span>(<span style='color:deepskyblue'>)</span>


<span style='color:deepskyblue'>@</span><span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>patch</span>(
    <span style='color:crimson'>"pytube.streams.request.head"</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>MagicMock</span>(<span style='color:darkgreen'>return_value</span><span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>{</span><span style='color:crimson'>"content-length"</span><span style='color:deepskyblue'>:</span> <span style='color:crimson'>"16384"</span><span style='color:deepskyblue'>}</span><span style='color:deepskyblue'>)</span>
<span style='color:deepskyblue'>)</span>
<span style='color:deepskyblue'>@</span><span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>patch</span>(
    <span style='color:crimson'>"pytube.streams.request.stream"</span><span style='color:deepskyblue'>,</span>
    <span style='color:darkgreen'>MagicMock</span>(<span style='color:darkgreen'>return_value</span><span style='color:deepskyblue'>=</span><span style='color:darkgreen'>iter</span>(<span style='color:deepskyblue'>[</span><span style='color:darkgreen'>str</span>(<span style='color:darkgreen'>random</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>getrandbits</span>(<span style='color:turquoise'>8</span> <span style='color:fuchsia'>*</span> <span style='color:turquoise'>1024</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>,</span>
<span style='color:deepskyblue'>)</span>
<span style='color:deepskyblue'>@</span><span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>patch</span>(<span style='color:crimson'>"pytube.streams.target_directory"</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>MagicMock</span>(<span style='color:darkgreen'>return_value</span><span style='color:deepskyblue'>=</span><span style='color:crimson'>"/target"</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span>
<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>test_download_with_prefix</span>(<span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:blueviolet'>with</span> <span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>patch</span>(<span style='color:crimson'>"pytube.streams.open"</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>mock_open</span>(<span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>create</span><span style='color:deepskyblue'>=</span><span style='color:blueviolet'>True</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkgreen'>stream</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>streams</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>0</span><span style='color:deepskyblue'>]</span>
        <span style='color:darkgreen'>file_path</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>stream</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>download</span>(<span style='color:darkgreen'>filename_prefix</span><span style='color:deepskyblue'>=</span><span style='color:crimson'>"prefix"</span><span style='color:deepskyblue'>)</span>
        <span style='color:blueviolet'>assert</span> <span style='color:darkgreen'>file_path</span> <span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>os</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>path</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>join</span>(
            <span style='color:crimson'>"/target"</span><span style='color:deepskyblue'>,</span>
            <span style='color:crimson'>"prefixYouTube Rewind 2019 For the Record  YouTubeRewind.mp4"</span>
        <span style='color:deepskyblue'>)</span>


<span style='color:deepskyblue'>@</span><span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>patch</span>(
    <span style='color:crimson'>"pytube.streams.request.head"</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>MagicMock</span>(<span style='color:darkgreen'>return_value</span><span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>{</span><span style='color:crimson'>"content-length"</span><span style='color:deepskyblue'>:</span> <span style='color:crimson'>"16384"</span><span style='color:deepskyblue'>}</span><span style='color:deepskyblue'>)</span>
<span style='color:deepskyblue'>)</span>
<span style='color:deepskyblue'>@</span><span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>patch</span>(
    <span style='color:crimson'>"pytube.streams.request.stream"</span><span style='color:deepskyblue'>,</span>
    <span style='color:darkgreen'>MagicMock</span>(<span style='color:darkgreen'>return_value</span><span style='color:deepskyblue'>=</span><span style='color:darkgreen'>iter</span>(<span style='color:deepskyblue'>[</span><span style='color:darkgreen'>str</span>(<span style='color:darkgreen'>random</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>getrandbits</span>(<span style='color:turquoise'>8</span> <span style='color:fuchsia'>*</span> <span style='color:turquoise'>1024</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>,</span>
<span style='color:deepskyblue'>)</span>
<span style='color:deepskyblue'>@</span><span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>patch</span>(<span style='color:crimson'>"pytube.streams.target_directory"</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>MagicMock</span>(<span style='color:darkgreen'>return_value</span><span style='color:deepskyblue'>=</span><span style='color:crimson'>"/target"</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span>
<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>test_download_with_filename</span>(<span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:blueviolet'>with</span> <span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>patch</span>(<span style='color:crimson'>"pytube.streams.open"</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>mock_open</span>(<span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>create</span><span style='color:deepskyblue'>=</span><span style='color:blueviolet'>True</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkgreen'>stream</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>streams</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>0</span><span style='color:deepskyblue'>]</span>
        <span style='color:darkgreen'>file_path</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>stream</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>download</span>(<span style='color:darkgreen'>filename</span><span style='color:deepskyblue'>=</span><span style='color:crimson'>"cool name bro"</span><span style='color:deepskyblue'>)</span>
        <span style='color:blueviolet'>assert</span> <span style='color:darkgreen'>file_path</span> <span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>os</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>path</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>join</span>(
            <span style='color:crimson'>"/target"</span><span style='color:deepskyblue'>,</span>
            <span style='color:crimson'>"cool name bro.mp4"</span>
        <span style='color:deepskyblue'>)</span>


<span style='color:deepskyblue'>@</span><span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>patch</span>(
    <span style='color:crimson'>"pytube.streams.request.head"</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>MagicMock</span>(<span style='color:darkgreen'>return_value</span><span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>{</span><span style='color:crimson'>"content-length"</span><span style='color:deepskyblue'>:</span> <span style='color:crimson'>"16384"</span><span style='color:deepskyblue'>}</span><span style='color:deepskyblue'>)</span>
<span style='color:deepskyblue'>)</span>
<span style='color:deepskyblue'>@</span><span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>patch</span>(
    <span style='color:crimson'>"pytube.streams.request.stream"</span><span style='color:deepskyblue'>,</span>
    <span style='color:darkgreen'>MagicMock</span>(<span style='color:darkgreen'>return_value</span><span style='color:deepskyblue'>=</span><span style='color:darkgreen'>iter</span>(<span style='color:deepskyblue'>[</span><span style='color:darkgreen'>str</span>(<span style='color:darkgreen'>random</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>getrandbits</span>(<span style='color:turquoise'>8</span> <span style='color:fuchsia'>*</span> <span style='color:turquoise'>1024</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>,</span>
<span style='color:deepskyblue'>)</span>
<span style='color:deepskyblue'>@</span><span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>patch</span>(<span style='color:crimson'>"pytube.streams.target_directory"</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>MagicMock</span>(<span style='color:darkgreen'>return_value</span><span style='color:deepskyblue'>=</span><span style='color:crimson'>"/target"</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span>
<span style='color:deepskyblue'>@</span><span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>patch</span>(<span style='color:crimson'>"os.path.isfile"</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>MagicMock</span>(<span style='color:darkgreen'>return_value</span><span style='color:deepskyblue'>=</span><span style='color:blueviolet'>True</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span>
<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>test_download_with_existing</span>(<span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:blueviolet'>with</span> <span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>patch</span>(<span style='color:crimson'>"pytube.streams.open"</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>mock_open</span>(<span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>create</span><span style='color:deepskyblue'>=</span><span style='color:blueviolet'>True</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkgreen'>stream</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>streams</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>0</span><span style='color:deepskyblue'>]</span>
        <span style='color:darkgreen'>os</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>path</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>getsize</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>Mock</span>(<span style='color:darkgreen'>return_value</span><span style='color:deepskyblue'>=</span><span style='color:darkgreen'>stream</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>filesize</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>file_path</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>stream</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>download</span>(<span style='color:deepskyblue'>)</span>
        <span style='color:blueviolet'>assert</span> <span style='color:darkgreen'>file_path</span> <span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>os</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>path</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>join</span>(
            <span style='color:crimson'>"/target"</span><span style='color:deepskyblue'>,</span>
            <span style='color:crimson'>"YouTube Rewind 2019 For the Record  YouTubeRewind.mp4"</span>
        <span style='color:deepskyblue'>)</span>
        <span style='color:blueviolet'>assert</span> <span style='color:blueviolet'>not</span> <span style='color:darkgreen'>request</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>stream</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>called</span>


<span style='color:deepskyblue'>@</span><span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>patch</span>(
    <span style='color:crimson'>"pytube.streams.request.head"</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>MagicMock</span>(<span style='color:darkgreen'>return_value</span><span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>{</span><span style='color:crimson'>"content-length"</span><span style='color:deepskyblue'>:</span> <span style='color:crimson'>"16384"</span><span style='color:deepskyblue'>}</span><span style='color:deepskyblue'>)</span>
<span style='color:deepskyblue'>)</span>
<span style='color:deepskyblue'>@</span><span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>patch</span>(
    <span style='color:crimson'>"pytube.streams.request.stream"</span><span style='color:deepskyblue'>,</span>
    <span style='color:darkgreen'>MagicMock</span>(<span style='color:darkgreen'>return_value</span><span style='color:deepskyblue'>=</span><span style='color:darkgreen'>iter</span>(<span style='color:deepskyblue'>[</span><span style='color:darkgreen'>str</span>(<span style='color:darkgreen'>random</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>getrandbits</span>(<span style='color:turquoise'>8</span> <span style='color:fuchsia'>*</span> <span style='color:turquoise'>1024</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>,</span>
<span style='color:deepskyblue'>)</span>
<span style='color:deepskyblue'>@</span><span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>patch</span>(<span style='color:crimson'>"pytube.streams.target_directory"</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>MagicMock</span>(<span style='color:darkgreen'>return_value</span><span style='color:deepskyblue'>=</span><span style='color:crimson'>"/target"</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span>
<span style='color:deepskyblue'>@</span><span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>patch</span>(<span style='color:crimson'>"os.path.isfile"</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>MagicMock</span>(<span style='color:darkgreen'>return_value</span><span style='color:deepskyblue'>=</span><span style='color:blueviolet'>True</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span>
<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>test_download_with_existing_no_skip</span>(<span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:blueviolet'>with</span> <span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>patch</span>(<span style='color:crimson'>"pytube.streams.open"</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>mock_open</span>(<span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>create</span><span style='color:deepskyblue'>=</span><span style='color:blueviolet'>True</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkgreen'>stream</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>streams</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>0</span><span style='color:deepskyblue'>]</span>
        <span style='color:darkgreen'>os</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>path</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>getsize</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>Mock</span>(<span style='color:darkgreen'>return_value</span><span style='color:deepskyblue'>=</span><span style='color:darkgreen'>stream</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>filesize</span><span style='color:deepskyblue'>)</span>
        <span style='color:darkgreen'>file_path</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>stream</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>download</span>(<span style='color:darkgreen'>skip_existing</span><span style='color:deepskyblue'>=</span><span style='color:blueviolet'>False</span><span style='color:deepskyblue'>)</span>
        <span style='color:blueviolet'>assert</span> <span style='color:darkgreen'>file_path</span> <span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>os</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>path</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>join</span>(
            <span style='color:crimson'>"/target"</span><span style='color:deepskyblue'>,</span>
            <span style='color:crimson'>"YouTube Rewind 2019 For the Record  YouTubeRewind.mp4"</span>
        <span style='color:deepskyblue'>)</span>
        <span style='color:blueviolet'>assert</span> <span style='color:darkgreen'>request</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>stream</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>called</span>


<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>test_progressive_streams_return_includes_audio_track</span>(<span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:darkgreen'>stream</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>streams</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>filter</span>(<span style='color:darkgreen'>progressive</span><span style='color:deepskyblue'>=</span><span style='color:blueviolet'>True</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>0</span><span style='color:deepskyblue'>]</span>
    <span style='color:blueviolet'>assert</span> <span style='color:darkgreen'>stream</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>includes_audio_track</span>


<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>test_progressive_streams_return_includes_video_track</span>(<span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:darkgreen'>stream</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>streams</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>filter</span>(<span style='color:darkgreen'>progressive</span><span style='color:deepskyblue'>=</span><span style='color:blueviolet'>True</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>0</span><span style='color:deepskyblue'>]</span>
    <span style='color:blueviolet'>assert</span> <span style='color:darkgreen'>stream</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>includes_video_track</span>


<span style='color:deepskyblue'>@</span><span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>patch</span>(
    <span style='color:crimson'>"pytube.streams.request.head"</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>MagicMock</span>(<span style='color:darkgreen'>return_value</span><span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>{</span><span style='color:crimson'>"content-length"</span><span style='color:deepskyblue'>:</span> <span style='color:crimson'>"16384"</span><span style='color:deepskyblue'>}</span><span style='color:deepskyblue'>)</span>
<span style='color:deepskyblue'>)</span>
<span style='color:deepskyblue'>@</span><span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>patch</span>(
    <span style='color:crimson'>"pytube.streams.request.stream"</span><span style='color:deepskyblue'>,</span>
    <span style='color:darkgreen'>MagicMock</span>(<span style='color:darkgreen'>return_value</span><span style='color:deepskyblue'>=</span><span style='color:darkgreen'>iter</span>(<span style='color:deepskyblue'>[</span><span style='color:darkgreen'>str</span>(<span style='color:darkgreen'>random</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>getrandbits</span>(<span style='color:turquoise'>8</span> <span style='color:fuchsia'>*</span> <span style='color:turquoise'>1024</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>,</span>
<span style='color:deepskyblue'>)</span>
<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>test_on_progress_hook</span>(<span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:darkgreen'>callback_fn</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>MagicMock</span>(<span style='color:deepskyblue'>)</span>
    <span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>register_on_progress_callback</span>(<span style='color:darkgreen'>callback_fn</span><span style='color:deepskyblue'>)</span>

    <span style='color:blueviolet'>with</span> <span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>patch</span>(<span style='color:crimson'>"pytube.streams.open"</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>mock_open</span>(<span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>create</span><span style='color:deepskyblue'>=</span><span style='color:blueviolet'>True</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkgreen'>stream</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>streams</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>0</span><span style='color:deepskyblue'>]</span>
        <span style='color:darkgreen'>stream</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>download</span>(<span style='color:deepskyblue'>)</span>
    <span style='color:blueviolet'>assert</span> <span style='color:darkgreen'>callback_fn</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>called</span>
    <span style='color:darkgreen'>args</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>_</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>callback_fn</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>call_args</span>
    <span style='color:blueviolet'>assert</span> <span style='color:darkgreen'>len</span>(<span style='color:darkgreen'>args</span><span style='color:deepskyblue'>)</span> <span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>=</span> <span style='color:turquoise'>3</span>
    <span style='color:darkgreen'>stream</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>_</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>_</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>args</span>
    <span style='color:blueviolet'>assert</span> <span style='color:darkgreen'>isinstance</span>(<span style='color:darkgreen'>stream</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>Stream</span><span style='color:deepskyblue'>)</span>


<span style='color:deepskyblue'>@</span><span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>patch</span>(
    <span style='color:crimson'>"pytube.streams.request.head"</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>MagicMock</span>(<span style='color:darkgreen'>return_value</span><span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>{</span><span style='color:crimson'>"content-length"</span><span style='color:deepskyblue'>:</span> <span style='color:crimson'>"16384"</span><span style='color:deepskyblue'>}</span><span style='color:deepskyblue'>)</span>
<span style='color:deepskyblue'>)</span>
<span style='color:deepskyblue'>@</span><span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>patch</span>(
    <span style='color:crimson'>"pytube.streams.request.stream"</span><span style='color:deepskyblue'>,</span>
    <span style='color:darkgreen'>MagicMock</span>(<span style='color:darkgreen'>return_value</span><span style='color:deepskyblue'>=</span><span style='color:darkgreen'>iter</span>(<span style='color:deepskyblue'>[</span><span style='color:darkgreen'>str</span>(<span style='color:darkgreen'>random</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>getrandbits</span>(<span style='color:turquoise'>8</span> <span style='color:fuchsia'>*</span> <span style='color:turquoise'>1024</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>,</span>
<span style='color:deepskyblue'>)</span>
<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>test_on_complete_hook</span>(<span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:darkgreen'>callback_fn</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>MagicMock</span>(<span style='color:deepskyblue'>)</span>
    <span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>register_on_complete_callback</span>(<span style='color:darkgreen'>callback_fn</span><span style='color:deepskyblue'>)</span>

    <span style='color:blueviolet'>with</span> <span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>patch</span>(<span style='color:crimson'>"pytube.streams.open"</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>mock_open</span>(<span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>create</span><span style='color:deepskyblue'>=</span><span style='color:blueviolet'>True</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkgreen'>stream</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>streams</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>0</span><span style='color:deepskyblue'>]</span>
        <span style='color:darkgreen'>stream</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>download</span>(<span style='color:deepskyblue'>)</span>
    <span style='color:blueviolet'>assert</span> <span style='color:darkgreen'>callback_fn</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>called</span>


<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>test_author</span>(<span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:darkgreen'>expected</span> <span style='color:deepskyblue'>=</span> <span style='color:crimson'>"Test author"</span>
    <span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>_player_response</span> <span style='color:deepskyblue'>=</span> <span style='color:deepskyblue'>{</span><span style='color:crimson'>"videoDetails"</span><span style='color:deepskyblue'>:</span> <span style='color:deepskyblue'>{</span><span style='color:crimson'>"author"</span><span style='color:deepskyblue'>:</span> <span style='color:darkgreen'>expected</span><span style='color:deepskyblue'>}</span><span style='color:deepskyblue'>}</span>
    <span style='color:blueviolet'>assert</span> <span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>author</span> <span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>expected</span>

    <span style='color:darkgreen'>expected</span> <span style='color:deepskyblue'>=</span> <span style='color:crimson'>"unknown"</span>
    <span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>author</span> <span style='color:deepskyblue'>=</span> <span style='color:blueviolet'>None</span>
    <span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>_player_response</span> <span style='color:deepskyblue'>=</span> <span style='color:deepskyblue'>{</span><span style='color:crimson'>'key'</span><span style='color:deepskyblue'>:</span> <span style='color:crimson'>'value'</span><span style='color:deepskyblue'>}</span>
    <span style='color:blueviolet'>assert</span> <span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>author</span> <span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>expected</span>


<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>test_thumbnail_when_in_details</span>(<span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:darkgreen'>expected</span> <span style='color:deepskyblue'>=</span> <span style='color:crimson'>"some url"</span>
    <span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>_player_response</span> <span style='color:deepskyblue'>=</span> <span style='color:deepskyblue'>{</span>
        <span style='color:crimson'>"videoDetails"</span><span style='color:deepskyblue'>:</span> <span style='color:deepskyblue'>{</span><span style='color:crimson'>"thumbnail"</span><span style='color:deepskyblue'>:</span> <span style='color:deepskyblue'>{</span><span style='color:crimson'>"thumbnails"</span><span style='color:deepskyblue'>:</span> <span style='color:deepskyblue'>[</span><span style='color:deepskyblue'>{</span><span style='color:crimson'>"url"</span><span style='color:deepskyblue'>:</span> <span style='color:darkgreen'>expected</span><span style='color:deepskyblue'>}</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>}</span><span style='color:deepskyblue'>}</span>
    <span style='color:deepskyblue'>}</span>
    <span style='color:blueviolet'>assert</span> <span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>thumbnail_url</span> <span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>expected</span>


<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>test_thumbnail_when_not_in_details</span>(<span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:darkgreen'>expected</span> <span style='color:deepskyblue'>=</span> <span style='color:crimson'>"https://img.youtube.com/vi/2lAe1cqCOXo/maxresdefault.jpg"</span>
    <span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>_player_response</span> <span style='color:deepskyblue'>=</span> <span style='color:deepskyblue'>{</span><span style='color:crimson'>'key'</span><span style='color:deepskyblue'>:</span> <span style='color:crimson'>'value'</span><span style='color:deepskyblue'>}</span>
    <span style='color:blueviolet'>assert</span> <span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>thumbnail_url</span> <span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>expected</span>


<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>test_repr_for_audio_streams</span>(<span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:darkgreen'>stream</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>str</span>(<span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>streams</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>filter</span>(<span style='color:darkgreen'>only_audio</span><span style='color:deepskyblue'>=</span><span style='color:blueviolet'>True</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>0</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>)</span>
    <span style='color:darkgreen'>expected</span> <span style='color:deepskyblue'>=</span> (
        <span style='color:crimson'>'<Stream: itag="140" mime_type="audio/mp4" abr="128kbps" '</span>
        <span style='color:crimson'>'acodec="mp4a.40.2" progressive="False" type="audio">'</span>
    <span style='color:deepskyblue'>)</span>
    <span style='color:blueviolet'>assert</span> <span style='color:darkgreen'>stream</span> <span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>expected</span>


<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>test_repr_for_video_streams</span>(<span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:darkgreen'>stream</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>str</span>(<span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>streams</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>filter</span>(<span style='color:darkgreen'>only_video</span><span style='color:deepskyblue'>=</span><span style='color:blueviolet'>True</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>0</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>)</span>
    <span style='color:darkgreen'>expected</span> <span style='color:deepskyblue'>=</span> (
        <span style='color:crimson'>'<Stream: itag="137" mime_type="video/mp4" res="1080p" fps="24fps" '</span>
        <span style='color:crimson'>'vcodec="avc1.640028" progressive="False" type="video">'</span>
    <span style='color:deepskyblue'>)</span>
    <span style='color:blueviolet'>assert</span> <span style='color:darkgreen'>stream</span> <span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>expected</span>


<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>test_repr_for_progressive_streams</span>(<span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:darkgreen'>stream</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>str</span>(<span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>streams</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>filter</span>(<span style='color:darkgreen'>progressive</span><span style='color:deepskyblue'>=</span><span style='color:blueviolet'>True</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>0</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>)</span>
    <span style='color:darkgreen'>expected</span> <span style='color:deepskyblue'>=</span> (
        <span style='color:crimson'>'<Stream: itag="18" mime_type="video/mp4" res="360p" fps="24fps" '</span>
        <span style='color:crimson'>'vcodec="avc1.42001E" acodec="mp4a.40.2" progressive="True" '</span>
        <span style='color:crimson'>'type="video">'</span>
    <span style='color:deepskyblue'>)</span>
    <span style='color:blueviolet'>assert</span> <span style='color:darkgreen'>stream</span> <span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>expected</span>


<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>test_repr_for_adaptive_streams</span>(<span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:darkgreen'>stream</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>str</span>(<span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>streams</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>filter</span>(<span style='color:darkgreen'>adaptive</span><span style='color:deepskyblue'>=</span><span style='color:blueviolet'>True</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>0</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>)</span>
    <span style='color:darkgreen'>expected</span> <span style='color:deepskyblue'>=</span> (
        <span style='color:crimson'>'<Stream: itag="137" mime_type="video/mp4" res="1080p" fps="24fps" '</span>
        <span style='color:crimson'>'vcodec="avc1.640028" progressive="False" type="video">'</span>
    <span style='color:deepskyblue'>)</span>
    <span style='color:blueviolet'>assert</span> <span style='color:darkgreen'>stream</span> <span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>expected</span>


<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>test_segmented_stream_on_404</span>(<span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:darkgreen'>stream</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>streams</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>filter</span>(<span style='color:darkgreen'>adaptive</span><span style='color:deepskyblue'>=</span><span style='color:blueviolet'>True</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>0</span><span style='color:deepskyblue'>]</span>
    <span style='color:blueviolet'>with</span> <span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>patch</span>(<span style='color:crimson'>'pytube.request.head'</span><span style='color:deepskyblue'>)</span> <span style='color:blueviolet'>as</span> <span style='color:darkgreen'>mock_head</span><span style='color:deepskyblue'>:</span>
        <span style='color:blueviolet'>with</span> <span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>patch</span>(<span style='color:crimson'>'pytube.request.urlopen'</span><span style='color:deepskyblue'>)</span> <span style='color:blueviolet'>as</span> <span style='color:darkgreen'>mock_url_open</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkblue'># Mock the responses to YouTube</span>
            <span style='color:darkgreen'>mock_url_open_object</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>Mock</span>(<span style='color:deepskyblue'>)</span>

            <span style='color:darkblue'># These are our 4 "segments" of a dash stream</span>
            <span style='color:darkblue'># The first explains how many pieces there are, and</span>
            <span style='color:darkblue'># the rest are those pieces</span>
            <span style='color:darkgreen'>responses</span> <span style='color:deepskyblue'>=</span> <span style='color:deepskyblue'>[</span>
                <span style='color:chocolate'>b'Raw_data\r\nSegment-Count: 3'</span><span style='color:deepskyblue'>,</span>
                <span style='color:chocolate'>b'a'</span><span style='color:deepskyblue'>,</span>
                <span style='color:chocolate'>b'b'</span><span style='color:deepskyblue'>,</span>
                <span style='color:chocolate'>b'c'</span><span style='color:deepskyblue'>,</span>
            <span style='color:deepskyblue'>]</span>
            <span style='color:darkgreen'>joined_responses</span> <span style='color:deepskyblue'>=</span> <span style='color:chocolate'>b''</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>join</span>(<span style='color:darkgreen'>responses</span><span style='color:deepskyblue'>)</span>

            <span style='color:darkblue'># We create response headers to match the segments</span>
            <span style='color:darkgreen'>response_headers</span> <span style='color:deepskyblue'>=</span> <span style='color:deepskyblue'>[</span>
                <span style='color:deepskyblue'>{</span>
                    <span style='color:crimson'>'content-length'</span><span style='color:deepskyblue'>:</span> <span style='color:darkgreen'>len</span>(<span style='color:darkgreen'>r</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>,</span>
                    <span style='color:crimson'>'Content-Range'</span><span style='color:deepskyblue'>:</span> <span style='color:crimson'>'0-%s/%s'</span> <span style='color:fuchsia'>%</span> (<span style='color:darkgreen'>str</span>(<span style='color:darkgreen'>len</span>(<span style='color:darkgreen'>r</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>str</span>(<span style='color:darkgreen'>len</span>(<span style='color:darkgreen'>r</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>)</span>
                <span style='color:deepskyblue'>}</span>
                <span style='color:blueviolet'>for</span> <span style='color:darkgreen'>r</span> <span style='color:blueviolet'>in</span> <span style='color:darkgreen'>responses</span>
            <span style='color:deepskyblue'>]</span>

            <span style='color:darkblue'># Request order for stream:</span>
            <span style='color:darkblue'># Filesize:</span>
            <span style='color:darkblue'>#   1. head(url) -> 404</span>
            <span style='color:darkblue'>#   2. get(url&sn=0)</span>
            <span style='color:darkblue'>#   3. head(url&sn=[1,2,3])</span>
            <span style='color:darkblue'># Download:</span>
            <span style='color:darkblue'>#   4. info(url) -> 404</span>
            <span style='color:darkblue'>#   5. get(url&sn=0)</span>
            <span style='color:darkblue'>#   6. get(url&sn=[1,2,3])</span>

            <span style='color:darkblue'># Handle filesize requests</span>
            <span style='color:darkgreen'>mock_head</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>side_effect</span> <span style='color:deepskyblue'>=</span> <span style='color:deepskyblue'>[</span>
                <span style='color:darkgreen'>HTTPError</span>(<span style='color:crimson'>''</span><span style='color:deepskyblue'>,</span> <span style='color:turquoise'>404</span><span style='color:deepskyblue'>,</span> <span style='color:crimson'>'Not Found'</span><span style='color:deepskyblue'>,</span> <span style='color:crimson'>''</span><span style='color:deepskyblue'>,</span> <span style='color:crimson'>''</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>,</span>
                <span style='color:fuchsia'>*</span><span style='color:darkgreen'>response_headers</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>1</span><span style='color:deepskyblue'>:</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>,</span>
            <span style='color:deepskyblue'>]</span>

            <span style='color:darkblue'># Each response must be followed by None, to break iteration</span>
            <span style='color:darkblue'>#  in the stream() function</span>
            <span style='color:darkgreen'>mock_url_open_object</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>read</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>side_effect</span> <span style='color:deepskyblue'>=</span> <span style='color:deepskyblue'>[</span>
                <span style='color:darkgreen'>responses</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>0</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>,</span> <span style='color:blueviolet'>None</span><span style='color:deepskyblue'>,</span>
                <span style='color:darkgreen'>responses</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>0</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>,</span> <span style='color:blueviolet'>None</span><span style='color:deepskyblue'>,</span>
                <span style='color:darkgreen'>responses</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>1</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>,</span> <span style='color:blueviolet'>None</span><span style='color:deepskyblue'>,</span>
                <span style='color:darkgreen'>responses</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>2</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>,</span> <span style='color:blueviolet'>None</span><span style='color:deepskyblue'>,</span>
                <span style='color:darkgreen'>responses</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>3</span><span style='color:deepskyblue'>]</span><span style='color:deepskyblue'>,</span> <span style='color:blueviolet'>None</span><span style='color:deepskyblue'>,</span>
            <span style='color:deepskyblue'>]</span>

            <span style='color:darkblue'># This handles the HEAD requests to get content-length</span>
            <span style='color:darkgreen'>mock_url_open_object</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>info</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>side_effect</span> <span style='color:deepskyblue'>=</span> <span style='color:deepskyblue'>[</span>
                <span style='color:darkgreen'>HTTPError</span>(<span style='color:crimson'>''</span><span style='color:deepskyblue'>,</span> <span style='color:turquoise'>404</span><span style='color:deepskyblue'>,</span> <span style='color:crimson'>'Not Found'</span><span style='color:deepskyblue'>,</span> <span style='color:crimson'>''</span><span style='color:deepskyblue'>,</span> <span style='color:crimson'>''</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>,</span>
                <span style='color:fuchsia'>*</span><span style='color:darkgreen'>response_headers</span>
            <span style='color:deepskyblue'>]</span>

            <span style='color:darkgreen'>mock_url_open</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>return_value</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>mock_url_open_object</span>

            <span style='color:blueviolet'>with</span> <span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>patch</span>(<span style='color:crimson'>'builtins.open'</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>new_callable</span><span style='color:deepskyblue'>=</span><span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>mock_open</span><span style='color:deepskyblue'>)</span> <span style='color:blueviolet'>as</span> <span style='color:darkgreen'>mock_open</span><span style='color:deepskyblue'>:</span>
                <span style='color:darkgreen'>file_handle</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>mock_open</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>return_value</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>__enter__</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>return_value</span>
                <span style='color:darkgreen'>fp</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>stream</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>download</span>(<span style='color:deepskyblue'>)</span>
                <span style='color:darkgreen'>full_content</span> <span style='color:deepskyblue'>=</span> <span style='color:chocolate'>b''</span>
                <span style='color:blueviolet'>for</span> <span style='color:darkgreen'>call</span> <span style='color:blueviolet'>in</span> <span style='color:darkgreen'>file_handle</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>write</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>call_args_list</span><span style='color:deepskyblue'>:</span>
                    <span style='color:darkgreen'>args</span><span style='color:deepskyblue'>,</span> <span style='color:darkgreen'>kwargs</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>call</span>
                    <span style='color:darkgreen'>full_content</span> <span style='color:deepskyblue'>+=</span> <span style='color:chocolate'>b''</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>join</span>(<span style='color:darkgreen'>args</span><span style='color:deepskyblue'>)</span>

                <span style='color:blueviolet'>assert</span> <span style='color:darkgreen'>full_content</span> <span style='color:deepskyblue'>=</span><span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>joined_responses</span>
                <span style='color:darkgreen'>mock_open</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>assert_called_once_with</span>(<span style='color:darkgreen'>fp</span><span style='color:deepskyblue'>,</span> <span style='color:crimson'>'wb'</span><span style='color:deepskyblue'>)</span>


<span style='color:blueviolet'>def</span> <span style='color:darkgreen'>test_segmented_only_catches_404</span>(<span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
    <span style='color:darkgreen'>stream</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>cipher_signature</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>streams</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>filter</span>(<span style='color:darkgreen'>adaptive</span><span style='color:deepskyblue'>=</span><span style='color:blueviolet'>True</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>[</span><span style='color:turquoise'>0</span><span style='color:deepskyblue'>]</span>
    <span style='color:blueviolet'>with</span> <span style='color:darkgreen'>mock</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>patch</span>(<span style='color:crimson'>'pytube.request.head'</span><span style='color:deepskyblue'>)</span> <span style='color:blueviolet'>as</span> <span style='color:darkgreen'>mock_head</span><span style='color:deepskyblue'>:</span>
        <span style='color:darkgreen'>mock_head</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>side_effect</span> <span style='color:deepskyblue'>=</span> <span style='color:darkgreen'>HTTPError</span>(<span style='color:crimson'>''</span><span style='color:deepskyblue'>,</span> <span style='color:turquoise'>403</span><span style='color:deepskyblue'>,</span> <span style='color:crimson'>'Forbidden'</span><span style='color:deepskyblue'>,</span> <span style='color:crimson'>''</span><span style='color:deepskyblue'>,</span> <span style='color:crimson'>''</span><span style='color:deepskyblue'>)</span>
        <span style='color:blueviolet'>with</span> <span style='color:darkgreen'>pytest</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>raises</span>(<span style='color:darkgreen'>HTTPError</span><span style='color:deepskyblue'>)</span><span style='color:deepskyblue'>:</span>
            <span style='color:darkgreen'>stream</span><span style='color:deepskyblue'>.</span><span style='color:darkgreen'>download</span>(<span style='color:deepskyblue'>)</span>
        </pre>
    </body>
</html>